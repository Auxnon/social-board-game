(self.webpackChunkbuup=self.webpackChunkbuup||[]).push([[179],{285:(e,n,t)=>{"use strict";t.d(n,{a:()=>ei});var i={};t.r(i),t.d(i,{_O:()=>Zn,S1:()=>Sn,Z2:()=>et,Qc:()=>nt,A$:()=>Tn,V8:()=>qn,KT:()=>Dn,LP:()=>Mn,_:()=>An,W1:()=>zn,D9:()=>jn});var o={};t.r(o),t.d(o,{mS:()=>Wt,n6:()=>jt,UX:()=>Ot,bK:()=>Yt,GI:()=>Gt,pk:()=>At,S1:()=>Rt,u7:()=>Bt,b5:()=>Kt,hM:()=>zt,gw:()=>Vt,SI:()=>qt,ob:()=>Xt,j3:()=>Ft});var a,r,l=t(642);function s(e){"string"!=typeof e&&(e=e.toString(16)),e.startsWith("#")?e=e.substring(1):e.startsWith("0x")&&(e=e.substring(2));let n=0,t=0,i=0;return 3==e.length?(n="0x"+e[0]+e[0],t="0x"+e[1]+e[1],i="0x"+e[2]+e[2]):6==e.length&&(n="0x"+e[0]+e[1],t="0x"+e[2]+e[3],i="0x"+e[4]+e[5]),[parseInt(n),parseInt(t),parseInt(i)]}function c(e){var n=e.toString(16);return 1==n.length?"0"+n:n}function d(e,n,t){return function(e,n,t){return"#"+c(e)+c(n)+c(t)}(e=Math.floor(256*e),n=Math.floor(256*n),t=Math.floor(256*t))}function u(e){let n=.299*e[0]+.587*e[1]+.114*e[2];return console.log(n),n>186}function p(e,n,t){n?e.scale.set(n,n,n):e.scale.set(110,110,110),t?e.position.set(0,0,t):e.position.set(0,0,-30),a.add(e);let i=document.createElement("img");return i.className="hexPortrait",i.setAttribute("src",Ot(a,r)),a.remove(e),i}var h=t(321);let m,f,g;function v(e,n,t){let i=document.createElement("div");i.className="uiSysTop";let o=document.createElement("div"),a=" ";if("object"==typeof n&&null!==n)n.type&&(a+=n.type),n.color&&(i.style.backgroundColor=n.color);else switch(n){case"warn":a+="uiIconWarning",i.style.backgroundColor="#EFEF79";break;case"error":a+="uiIconError",i.style.backgroundColor="#D25E5E";break;case"net":a+="uiIconNet",i.style.backgroundColor="#FFC65E";break;case"person":a+="uiIconPerson",i.style.backgroundColor="#D257FF";break;case"time":a+="uiIconTime",i.style.backgroundColor="#5094D9";break;case"success":a+="uiIconSuccess",i.style.backgroundColor="#95F17F"}o.className="uiIcon"+a;let r=document.createElement("span");function l(){i.style.animation=t?"0.5s uiSysMini forwards":"0.5s uiSysFold forwards",setTimeout((function(){t?(i.style.position="absolute",i.style.left="-64px",i.addEventListener("click",(function(e){i.style.animation="0.5s uiSysMax forwards",setTimeout((function(){i.style.animation="0.5s uiSysMini forwards"}),3500)}))):i.remove()}),500)}if(r.innerText=e,r.addEventListener("click",(function(e){!function(e){g.value=e.innerText,g.style.display="block",g.select(),document.execCommand("copy"),g.blur(),g.style.display="none"}(r),function(e,n,t){let i=document.createElement("div");i.className="uiCursorMessage",i.style.left=e+"px",i.style.top=n+"px",i.innerText="Copied",m.appendChild(i),setTimeout((function(){i.style.animation="1s uiFade forwards",setTimeout((function(){i.remove()}),1e3)}),1500)}(e.clientX,e.clientY)})),i.appendChild(o),i.appendChild(r),!t){let e=document.createElement("div");e.className="uiCloseButton",i.appendChild(e),e.addEventListener("click",(function(e){l()}))}return setTimeout((function(){l()}),3500),f.appendChild(i),i}var y,w,x,b,_,E,k;function S(){return w}var L,z,C,T=!1,M=1,A=!1,P=0,N=void 0,H={x:0,y:0};function I(e){let n=b[e];n&&(n.classList.add("cardMax"),n.focused=!0,n.style.zIndex=0,Object.values(n.children).forEach((e=>{"card-notifier"==e.className?e.remove():e.style.display="initial"})),"landscapeCard"==n.id?Mn(!0):Mn(!1),"chatCard"==n.id&&(et(),X.focus()),"npcCard"==n.id?An(!0):An(!1),-1==n.spot?(C.style.top="32px",C.style.left="32px"):(C.style.top=n.style.top,C.style.left=n.style.left),setTimeout((()=>{C.style.opacity="1",C.style.pointerEvents="auto"}),100),k=n)}function R(){console.log("close called"),k&&(console.log("focused close called"),k.classList.remove("cardMax"),k.style.zIndex=2,k.focused=void 0,Tn(),Mn(!1),An(!1),Object.values(k.children).forEach((e=>{"card-notifier"==e.className?e.style.display="initial":e.style.display="none"})),C.style.opacity="0",C.style.pointerEvents="none"),A&&(A=!1,W())}function F(){clearTimeout(z),z=setTimeout((function(){W(),qt()}),250)}function B(e){let n=0,t=[],i=0==M||2==M;e?(n=b.length,t=b):b.forEach((e=>{-1!=e.spot&&(t.push(e),n++)})),i?(_.style.height=64*(n>0?n:1)+"px",_.style.width="82px"):(_.style.width=64*(n>0?n:1)+"px",_.style.height="82px");let o=_.getBoundingClientRect();E=o;let a,r=o.width,l=o.height;a=i?l/n:r/n,e||(i?t.sort((function(e,n){return parseInt(e.style.top)-parseInt(n.style.top)})):t.sort((function(e,n){return parseInt(e.style.left)-parseInt(n.style.left)})));for(let u=0;u<n;u++)L[u]=i?{x:o.left+r/2,y:32+o.top+u*a}:{x:32+o.left+u*a,y:o.top+l/2},N&&N==t[u]&&(H=L[u]),e&&(b[u].spot=u,L[u].app=t[u]),s=t[u],c=L[u].x,d=L[u].y,void 0||(s.pos={x:c,y:d}),s.style.left=c+"px",s.style.top=d+"px";var s,c,d;let u=barHandle.getBoundingClientRect();if(i){let e=u.left+u.width/2;D({x:e,y:u.top},{x:e,y:u.bottom})}else{let e=u.top+u.height/2;D({x:u.left,y:e},{x:u.right,y:e})}}function q(){requestAnimationFrame(q)}function D(e,n){e.x,e.y,n.x,n.y}function O(e){if(function(e){if(T){P++;let n=e.clientX,t=e.clientY,i=window.innerWidth/2,o=window.innerHeight/2,a=n-i,r=t-o,l=i-Math.abs(a)<10,s=o-Math.abs(r)<10,c=Math.atan2(r,a)/Math.PI,d=Math.abs(c);d<.25?(2!=M&&(M=2,W()),l!=A&&(A=l,W())):d<.75?(c<0?3!=M&&(M=3,W()):1!=M&&(M=1,W()),s!=A&&(A=s,W())):(0!=M&&(M=0,W()),l!=A&&(A=l,W()))}}(e),N){if(P++,N.pos={x:e.clientX+N.offset.x,y:e.clientY+N.offset.y},e.clientY>E.top&&e.clientY<E.bottom&&e.clientX>E.left&&e.clientX<E.right){let e=H,n={x:e.x-N.pos.x,y:e.y-N.pos.y};N.pos={x:e.x-n.x/3,y:e.y-n.y/3},N.moving&&(N.moving=void 0,N.spot=0,B())}else N.moving||(N.moving=!0,N.spot=-1,B());N.style.left=N.pos.x+"px",N.style.top=N.pos.y+"px"}}function W(){2==M?(_.style.left=window.innerWidth-(A?-32:48)+"px",_.style.top="50%",B(),barHandle.style.transform="translate(-200%,-50%)",barHandle.style.width="32px",barHandle.style.height="80%",_.style.borderWidth="0px 0px 0px 6px",fe(!1)):3==M?(barHandle.style.transform="translate(-50%,100%)",_.style.left="50%",_.style.top=(A?-32:48)+"px",B(),barHandle.style.height="32px",barHandle.style.width="80%",_.style.borderWidth="0px 0px 6px 0px",fe(!1)):1==M?(barHandle.style.transform="translate(-50%,-200%)",_.style.left="50%",_.style.top=window.innerHeight-(A?-32:48)+"px",B(),barHandle.style.height="32px",barHandle.style.width="80%",_.style.borderWidth="6px 0px 0px 0px",fe(!0)):(barHandle.style.transform="translate(100%,-50%)",_.style.left=(A?-32:48)+"px",_.style.top="50%",B(),barHandle.style.width="32px",barHandle.style.height="80%",_.style.borderWidth="0px 6px 0px 0px",fe(!1))}function j(e){T&&(T=!1,console.log(P),P<10&&R()),N?(N.classList.remove("cardMove"),P<20?(k&&k==N&&(N.classList.remove("cardMax"),N.focused=void 0,k=void 0,N.style.zIndex=2),R(),I(N.appId)):(B(),console.log("fix bar also"))):(B(),console.log("fix bar")),N=void 0,P=0}var V,U,Y,G,J,X,K,Z=!1,Q="black";function $(){Z=!0}function ee(e){if(Z){V.fillStyle=Q;let n=e.target.getBoundingClientRect();V.fillRect(32*(e.clientX-n.left)/132,32*(e.clientY-n.top)/132,2,2)}}function ne(e){Z=!1}function te(e){oe(e.target),V.fillStyle="rgba(255, 255, 255, 0)",V.clearRect(0,0,32,32)}function ie(e){oe(e.target),function(e){let n=document.createElement("a");n.href=e,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}(e.target.parentElement.parentElement.querySelector(".drawer").toDataURL("image/png"))}function oe(e){e.style.animationName="",e.offsetWidth,e.style.animationName="jello"}function ae(e){oe(e.target),Q=e.target.style.backgroundColor}function re(e){let n=document.createElement("div");return e&&(n.className=e),n}function le(){return G}var se,ce=-1,de=null,ue=-1;function pe(e,n){let t=function(e){return y[e]}(e);t||(t={username:"Unknown",id:-1,color:"black"}),function(e,n,t){let i=document.createElement("p"),o=n.color;i.style.backgroundColor=o;let a=u(s(o));i.style.color=a?"#000000":"#FFFFFF",i.style.textShadow="1px 1px 2px "+(a?"#FFFFFF":"#000000");let r=e.indexOf("data:image");if(r>-1){let n=e.indexOf("#",r);if(n>-1){let t=e.substring(r,n);console.log(t);let o=new Image;o.className="stretch-image",o.src=t,i.appendChild(o),e=e.substring(n+1)}}i.innerHTML+=e;{let e=document.createElement("div");if(e.classList.add("chat-row"),n.id==S().id&&e.classList.add("chat-right"),i.classList.add("chat-bubble"),ue>=0&&ue==n.id)ce==n.id?(de.classList.remove("chat-bubble-footer"),de.classList.add("chat-bubble-body")):de.classList.add("chat-bubble-header"),i.classList.add("chat-bubble-footer");else{let e=document.createElement("p");e.classList.add("chat-nametag"),e.innerHTML=n.username;let t=document.createElement("div");n.id==S().id&&(t.style.textAlign="right"),t.appendChild(e),J.appendChild(t)}ce=ue,de=i,ue=n.id,e.appendChild(i),J.appendChild(e),J.scrollTop=J.scrollHeight}}(n,t),function(e,n){let t=b[2];if(!t.focused){let e=t.querySelector(".card-notifier");e?e.innerText=parseInt(e.innerText)+1:(e=document.createElement("div"),e.className="card-notifier",t.appendChild(e),e.innerText=1),t.style.animation="",t.offsetWidth,t.style.animation="attention 0.2s"}}()}function he(){X.blur(),R(),nt(!1)}function me(e){let n=document.createElement("div");n.className="chat-divider";let t=document.createElement("p");t.innerText=e,n.appendChild(t),J.appendChild(n)}function fe(e){e?(J.style.height="calc(100vh - 100px)",K.style.bottom="100px"):(J.style.height="calc(100vh - 64px)",K.style.bottom="0px")}var ge,ve=!1;function ye(e,n,t,i,o,a,r){se.emit("physMake",e,n,t,i,o,a,r)}function we(e){e||(e="test"),se.emit("message",e)}function xe(e,n){se.emit("sendPhys",{id:e.id,position:e.position,velocity:e.velocity,quaternion:e.quaternion,angularVelocity:e.angularVelocity},n)}var be=[],_e=[],Ee=[];var ke,Se,Le,ze=2;function Ce(e,n,t){Ee[e][n]=t,Te()}function Te(){Oe=6,Ae();for(let n=0;n<Ee.length;n++)for(let t=0;t<Ee.length;t++){let i=Ee[n][t],o=Math.floor(We(1,4)),a=Math.floor(We(1,6));if(1!=i){let o,r,l,s,c,d;o=n>0?Ee[n-1][t]:0,r=n<Ee.length-1?Ee[n+1][t]:0,t<Ee.length-1?(l=n>0?Ee[n-1][t+1]:0,s=Ee[n][t+1]):(l=0,s=0),t>0?(c=Ee[n][t-1],d=n<Ee.length-1?Ee[n+1][t-1]:0):(c=0,d=0),o=o==i,r=r==i,s=s==i,d=d==i,c=c==i,l=l==i;let u=-1,p=0,h=[],m=5;[l,s,r,d,c,o].forEach(((e,n)=>{e?(h.push(n),-1==u&&(u=n),p=n):m=n}));let f="N",g="";if(6==h.length)Me(i,"H"+g,n,t,Math.floor(a));else if(h.length>0){let o=[];var e=h[0];for(let n=1;n<h.length;n++)o.push(h[n]-e-1),e=h[n];let a=-1==u?0:u;switch(h.length){case 1:f="E",a+=0;break;case 2:f="P",0==o[0]?(g="3",a+=0):1==o[0]?(g="2",a+=0):2==o[0]?(g="1",a+=0):3==o[0]?(g="2",a+=4):(g="3",a+=5);break;case 3:f="T",0==o[0]?0==o[1]?(g=1,a+=0):3==o[1]?(g=1,a+=5):1==o[1]?(g=3,a+=3):2==o[1]&&(g=2,a+=4):1==o[0]?0==o[1]?g=2:1==o[1]?g=4:2==o[1]&&(g=3,a+=2):2==o[0]?0==o[1]?(g=3,a+=0):1==o[1]&&(g=2,a+=3):(g=1,a+=4),a%=6;break;case 4:f="Q",0==o[0]?0==o[1]?0==o[2]?(g=1,a+=0):1==o[2]?(g=3,a+=2):2==o[2]&&(g=1,a+=5):1==o[1]?0==o[2]?(g=2,a+=4):1==o[2]&&(g=3,a+=1):(g=1,a+=4):1==o[0]?0==o[1]?0==o[2]?(g=3,a+=4):g=2:g=3:(g=1,a+=3),a%=6;break;case 5:f="F",a=m+1}Me(i,f+g,n,t,a)}else Me(i,"N",n,t,0)}else 1==i&&Me(i,"O"+o,n,t,Math.floor(a))}}function Me(e,n,t,i,o){let a=8*Math.sqrt(3)/2,r="Grass_";switch(e){case 1:r="Grass_";break;case 0:r="Water_";break;case 3:r="Mount_";break;case 4:r="Tree_";break;case 5:r="House_"}let l=be[r+n];if(l){let e=l.clone();e.position.set(t*a*2-48+i*a,8*i*1.5,-1.6),o&&(o=6-o,e.rotation.z=o*Math.PI/3),_e.push(e),Wt(e)}else console.log("invalid model "+r+n)}function Ae(){_e.forEach((e=>{Vt(e)})),_e=[]}function Pe(e,n){let t=8*Math.sqrt(3)/2,i=Math.floor((8+n)/12),o=Math.floor((e+48+8-i*t)/(2*t));return ke.position.set(o*t*2-48+i*t,8*i*1.5,.8),[o,i]}let Ne={x:0,y:0},He=0;var Ie,Re,Fe,Be,qe,De,Oe=6;function We(e,n){return(n=n||0)+(Oe=(9301*Oe+49297)%233280)/233280*((e=e||1)-n)}function je(e){return be[e].clone()}function Ve(e,n){Ee=n,Te()}var Ue=2048;Math.PI;let Ye,Ge=1,Je=-.001;function Xe(e){let n;switch(e){case 4:n=600,Re.shadow.camera.far=1200,Re.shadow.mapSize.width=Ue,Re.shadow.mapSize.height=Ue,Ye=100,Re.position.z=600;break;case 3:n=300,Re.shadow.camera.far=600,Re.shadow.mapSize.width=Ue,Re.shadow.mapSize.height=Ue,Ye=100,Re.position.z=300;break;case 2:n=120,Re.shadow.camera.far=240,Re.shadow.mapSize.width=Ue,Re.shadow.mapSize.height=Ue,Ye=40,Re.position.z=120;break;case 1:n=75,Re.shadow.camera.far=150,Re.shadow.mapSize.width=Ue,Re.shadow.mapSize.height=Ue,Ye=25,Re.position.z=75;break;default:n=30,Re.shadow.camera.far=60,Re.shadow.mapSize.width=Ue,Re.shadow.mapSize.height=Ue,Ye=10,Re.position.z=30}Re.shadow.camera.left=-n,Re.shadow.camera.right=n,Re.shadow.camera.top=n,Re.shadow.camera.bottom=-n,Re.shadow.map&&(Re.shadow.map.dispose(),Re.shadow.map=null),Ie&&setTimeout((function(){Ie.update()}),100)}function Ke(e){e?Ie?Ie.visible=!0:Wt(Ie=new l.Rki(Re.shadow.camera)):Ie&&(Ie.visible=!1)}var Ze,Qe,$e,en,nn=t(429),tn={},on={};function an(e,n){Bt(e,((e,t)=>{n(e,t)}))}function rn(e){an("assets/models/"+e+".gltf",(n=>{n.scale.set(2,2,2),n.castShadow=!0,n.receiveShadow=!0,function(e,n){let t=e.replace(/[0-9]/g,"");if(t!=e)if(on[t]){if(!Array.isArray(on[t])){let e=on[t];on[t]=[e]}on[t].push(n)}else on[t]=n;on[e]=n}(e,n)}))}function ln(e,n,t){if(e.geometry)sn(e,e.geometry,n,t);else if(e.children&&e.children.length>0)for(let i=0;i<e.children.length;i++)e.children[i].geometry&&sn(e,e.children[i].geometry,n,t)}function sn(e,n,t,i){if(!n)return;let o,a=t&&i,r=n.attributes.color.array,l=[];for(let e=0;e<r.length;e++)if(o=e%4,o>=3)if(a)r[e-3]==t[0]&&r[e-2]==t[1]&&r[e-1]==t[2]&&(r[e-3]=i[0],r[e-2]=i[1],r[e-1]=i[2]);else{let n=d(r[e-3],r[e-2],r[e-1]);l[n]=r[e-3]+","+r[e-2]+","+r[e-1]}a||Object.keys(l).forEach((t=>{console.log("%s %s %c %s %c %s",e.name,n.name,"background: "+t+"; color: #000",t,"background: white;",l[t])}))}var cn=["man","pot","rock","gran"];function dn(){return en}var un,pn=t(335),hn=!1,mn=!1,fn=void 0,gn=!1,vn=!1,yn=0,wn=0,xn=0,bn=0,_n=0,En=!1,kn=[];function Sn(){let e=document.querySelector(".canvasHolder");e.addEventListener("mousemove",Pn),e.addEventListener("mousedown",Nn),e.addEventListener("mouseup",Hn),e.addEventListener("touchstart",In),e.addEventListener("touchend",Rn),e.addEventListener("touchmove",Bn),window.addEventListener("contextmenu",Kn),window.addEventListener("keyup",$n)}var Ln=!1;function zn(e,n,t,i){!function(e,n){(un=new pn.z(n,e)).callbackCounts=e=>{1==e?fn=setTimeout((function(){gn=!0}),100):fn&&clearTimeout(fn)},un.mouseButtons={LEFT:void 0,MIDDLE:l.RsA.ROTATE,RIGHT:l.RsA.PAN},un.maxPolarAngle=1.3,un.isControl(),Tn(),un.addEventListener("change",(function(e){var n,t=un.target.distanceTo(un.object.position);t<30?(0!=Ln&&Xe(0),Ln=0):t<100?(1!=Ln&&Xe(1),Ln=1):t<180?(2!=Ln&&Xe(2),Ln=2):(3!=Ln&&Xe(3),Ln=3),n=un.target,qe.set(n.x,n.y,n.z),Re.position.x=n.x,Be.position.x=n.x})),un.addEventListener("end",(function(e){fn&&clearTimeout(fn),gn=!1}))}(n,t)}function Cn(){console.log("p2"),un.touches={ONE:69,TWO:l.QmN.DOLLY_PAN}}function Tn(){console.log("p1"),un.touches={ONE:l.QmN.PAN,TWO:l.QmN.DOLLY_ROTATE}}function Mn(e){(function(e){ke.visible=e})(hn=e),e&&Cn()}function An(e){mn=e,e&&Cn()}function Pn(e){Qn(e.clientX,e.clientY)}function Nn(e){return 1===e.which&&(vn=!0,!0)}function Hn(e){if(2===e.which)return!1;vn=!1,Fn()}function In(e){return vn=!0,yn=e.touches[0].clientX,wn=e.touches[0].clientY,!0}function Rn(e){vn&&(Yn||un.isControl()),vn=!1,Xn&&(document.querySelector(".bubbleSelector").style.visibility="hidden",Xn=!1),Fn()}function Fn(){hn&&(He=0,Ne.x=0,Ne.y=0),function(){if(Yn){Yn=void 0,document.querySelectorAll(".bubble").forEach((e=>{e.style.visibility="hidden"}));let e=document.querySelector(".overtext");e&&(e.style.visibility="hidden"),Jn>=0&&Gn[Jn](xn,bn,0),nt(!1)}}()}function Bn(e){Qn(e.touches[0].clientX,e.touches[0].clientY)}function qn(){return yn}function Dn(){return wn}var On=0,Wn=0;function jn(e){let n={x:e.x-xn,y:e.y-bn,z:e.z-_n};if(kn.push(n),kn.length>6&&kn.shift(),xn=e.x,bn=e.y,_n=e.z,hn)vn||Pe(xn,bn),(gn||vn)&&function(e,n){let[t,i]=Pe(e,n),o=Ee.length;(t!=Ne.x||i!=Ne.y)&&t>-1&&i>-1&&t<o&&i<o&&(0==He&&Ee[t][i]==ze?Ce(t,i,1):Ce(t,i,ze),He++,Ne.x=t,Ne.y=i,Se&&(clearTimeout(Se),Se=null),Se=setTimeout((function(){var e;e=Ee,se.emit("terrain",S().id,0,e)}),2e3))}(xn,bn);else if(mn){if(gn||vn){let e=dn();e&&(gn=!1,vn=!1,Un(),ye({x:1.5,y:1.5,z:3},2,{x:xn,y:bn,z:_n+.1},mt(Wn),1,S().color,e))}}else gn||vn?(Un(),1==(On=function(e,n){if(null==pt){let n,t=6;if(ct.forEach((i=>{if(null!=i.physId){let o=i.position.distanceTo(e);o<t&&(n=i.physId,t=o)}})),null!=n)return pt=st[n],1;pt=-1}else if(-1!=pt){let t=pt;return t.quaternion.setFromAxisAngle(new at.Vec3(0,0,1),n),t.position.copy(e),t.position.z+=6,t.sleep(),++ht>10&&(ht=0,xe(t,!0),console.log("send phys")),1}return 0}(e,Wn))&&(un.reset(),Cn())):On>-1&&(function(e,n){if(pt&&-1!=pt){let t=pt;t&&(t.wakeUp(),t.position.copy(e),t.velocity.copy(n),t.position.z+=6,ht=0,xe(t,!1),console.log("send phys NOW"))}pt=void 0}(e,Vn()),On=!1,On=-1,Tn())}function Vn(){let e={x:0,y:0,z:0};return kn.forEach((n=>{e.x+=n.x,e.y+=n.y,e.z+=n.z})),e}function Un(){let e=Vn();Math.sqrt(e.x*e.x+e.y*e.y)>.2&&(Wn=Math.PI/2+Math.atan2(e.y,e.x))}var Yn,Gn=[],Jn=-1,Xn=!1;function Kn(e){return e.preventDefault(),!1}function Zn(){return un.object.rotation.z}function Qn(e,n){Yn?function(e,n){let t=e-Yn.x,i=n-Yn.y,o=Math.sqrt(t*t+i*i),a=function(e,n){let t=Math.atan2(e,-n);return t<0&&(t=2*Math.PI+t),t}(t,i),r=document.querySelectorAll(".bubble"),l=2*Math.PI/r.length,s=a/l+l/2,c=Math.floor(s);c>=r.length&&(c=0),o>100&&(c=-1);let d="";r.forEach(((e,n)=>{n==c?(e.style.border="solid blue 6px",d=e.getAttribute("value")):e.style.border=""})),Math.PI;let u=document.querySelector(".overtext");c>-1?(u.style.visibility="visible",u.style.left=e+"px",u.style.top=n+"px",u.innerHTML=d,u.style.transform=t>25?"translate(28px,-50%)":t<-25?"translate(calc(-28px - 100%),-50%)":"translate(-50%,calc(-28px - 100%))"):u.style.visibility="hidden",Jn=c}(e,n):(yn=e,wn=n)}function $n(e){if(et())return!1;switch(console.log(e.which),e.which){case 13:I(2);break;case 27:R();break;case 49:Xe(0);break;case 50:Xe(1);break;case 51:Xe(2);break;case 52:Xe(3);break;case 53:Xe(4);break;case 84:ye({x:2,y:2,z:3},2,{x:xn,y:bn,z:30},mt(Math.PI/2),0,S().color,"rock");break;case 89:ye({x:1.5,y:1.5,z:3},2,{x:xn,y:bn,z:30},mt(Math.PI/2),1,S().color,"man");break;case 192:window.pickTarget=o.pick(),window.pickTarget&&console.log("picked a "+window.pickTarget.type)}}function et(){return En}function nt(e){En=e;let n=document.querySelectorAll(".menuHidable");n.length&&n.forEach((n=>{n.style.visibility=e?"hidden":"visible"}))}var tt,it,ot,at=t(279),rt=0;var lt=[],st=[],ct=[];function dt(e,n,t,i,o,a,r,c){let d,u,p=new at.Body({mass:t});if(d=a?new at.Cylinder(n.x,n.y,n.z,6):new at.Box(new at.Vec3(n.x,n.y,n.z)),p.addShape(d),p.position.set(i.x,i.y,i.z),o&&p.quaternion.copy(o),p.id=e,lt.push(e),st[e]=p,tt.push(p),it.addBody(p),c){let e=function(e,n){let t=on[e];if(t){if(Array.isArray(t))t=t[Math.floor(Math.random()*t.length)];else if(("man"==e||"gran"==e)&&n){t=nn.b.clone(t);let e=s(n).map((e=>e/256));return t.userData.shirt={value:new l.Pa4(e[0],e[1],e[2])},t.userData.wind={value:new l.Pa4(0,1,0)},t.children.forEach((e=>{e&&"SkinnedMesh"==e.type&&(e.castShadow=!0,e.receiveShadow=!0,"Gran"!=e.name&&"Man"!=e.name||(e.material=Qe.clone(),e.material.skinning=!0,e.material.needsUpdate=!0,e.material.uniforms.shirt=t.userData.shirt),e.name)})),t}return t.clone()}return At.clone()}(c,r);u=Kt(),e.position.z=-n.z/2,e.rotation.x=Math.PI/2,u.add(e)}else u=a?Gt(n.x,n.y,n.z,i.x,i.y,i.z,r):Yt(2*n.x,2*n.y,2*n.z,i.x,i.y,i.z,r);Wt(u),ct[e]=u,u.physId=e}function ut(e){e.forEach((e=>{let n=st[e[0]];n&&(n.position.copy(e[1]),n.quaternion.copy(e[2]),n.velocity.copy(e[3]),n.angularVelocity.copy(e[4]),n.sleepState!=e[5]&&(2==e[5]?n.sleep():2==n.sleepState&&n.wakeUp()))}))}var pt,ht=0;function mt(e){let n=new at.Quaternion(0,0,0,0);return n.setFromAxisAngle(new at.Vec3(0,0,1),e),n}var ft,gt,vt,yt,wt,xt,bt,_t,Et,kt,St,Lt,zt,Ct,Tt,Mt,At,Pt=t(145),Nt=t(38),Ht=(t(857),t(596)),It=t(26);function Rt(){var e;(ft=new l.cPb(45,window.innerWidth/window.innerHeight,1,5e3)).position.z=200,ft.position.y=-200,ft.up=new l.Pa4(0,0,1),ft.lookAt(new l.Pa4(0,0,0)),vt=new l.xsS,Jt=vt,kt=document.querySelector(".canvasHolder"),(gt=new l.CP7({antialias:!0,alpha:!0})).shadowMap.enabled=!0,gt.shadowMap.type=l.ntZ,gt.toneMapping=l.LY2,gt.outputEncoding=l.knz,gt.setClearColor(16744242,1),kt.appendChild(gt.domElement),_t=new Pt.E,e=l.rDY.merge([l.Vj0.standard.uniforms]),new l.jyz({uniforms:e,derivatives:!1,lights:!0,vertexColors:!0,vertexShader:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nuniform vec3 shirt;\nuniform vec3 wind;\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #ifdef USE_COLOR\n        if(color==vec3(0,0,1))\n            vColor.xyz = shirt;\n        else\n            vColor.xyz = color.xyz;\n        \n    #endif\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n    #ifdef USE_TANGENT\n        vTangent = normalize( transformedTangent );\n        vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n    #endif\n#endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    \n        if(color==vec3(1,0,0)){\n            float val=max(0.0, 1.0976 - transformed.z);\n            transformed.xyz+=val*wind;\n            transformed.y*=1.0+sin((wind.z+transformed.z)*4.0)/2.0;\n\n        }\n    \n\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n}",fragmentShader:"\n    #define STANDARD\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n    #define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n    uniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n    #ifdef TRANSPARENCY\n        diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n    #endif\n    gl_FragColor = vec4( outgoingLight,1.-(((0.2125 * outgoingLight.r) + (0.7154 * outgoingLight.g) + (0.0721 * outgoingLight.b)) ) );\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}",roughness:0,metalness:1}),Jt=vt,wt=ft,qt(),St=new Nt.x(gt);let n=new Ht.G(vt,ft,300,200);n.kernelRadius=6,n.minDistance=15e-5,n.maxDistance=.001,St.addPass(n),window.ssao=n,new l.vBJ({color:7722446}),new l.Wid({color:2156703,metalness:0,roughness:1}),new l.Wid({color:2156703,metalness:0,roughness:1}),new l.Wid({color:5534117,metalness:0,roughness:1});let t=new l.Wid({color:15398690,metalness:0,roughness:1});Lt=new l.Wid({color:13576926,metalness:0,roughness:1}),new l.Wid({color:11930379,metalness:0,roughness:1}),new l.Wid({color:15398690,metalness:0,roughness:1}),yt=new l.ZAu,zt=new l.ZAu;let i=new l.vBJ({color:16777215,side:l.Wl3}),o=new l.vBJ({color:3282968,side:l.Wl3}),a=Ut(1,1,2,0,0,0,t),r=Ut(1,.2,1,0,.5,.5,i),s=Ut(.3,.2,.3,0,.6,.5,o);zt.add(a),zt.add(r),zt.add(s),yt.add(zt);let c=Ut(.5,.5,1.5,.75,0,20,new l.vBJ({color:14035807}));yt.add(c),vt.add(yt),function(){let e=new l.zf8(3,8);Tt=new l.vBJ({color:4907322}),new l.vBJ({color:15461888}),(Ct=new l.Kj0(e,Tt)).position.z=.05,vt.add(Ct)}(),new l.Pa4(1,0,0),qe=new l.Pa4(0,0,0),jt(De=new l.Mig(9408399)),(Re=new l.Ox3(14702423,.5)).position.set(0,250,0),Re.castShadow=!0,jt(Re),(Be=new l.Tme).position.set(20,0,20),jt(Be),Re.target=Be,Re.shadow.mapSize.width=Ue,Re.shadow.mapSize.height=Ue,Re.shadow.camera.near=1,Xe(0),Re.shadow.radius=2.2,Re.shadow.bias=-5e-4,(Fe=Re.clone()).shadow.mapSize.width=256,Fe.shadow.mapSize.height=256,Fe.shadow.radius=0,Fe.visible=!1,jt(Fe),window.sunLight=Re,Ke(!0),zn(0,kt,ft);let d=new l.vBJ({color:16711680}),u=new l.vBJ({color:16746496}),p=new l.vBJ({color:16776960}),h=new l.vBJ({color:65280}),m=new l.vBJ({color:255}),f=new l.vBJ({color:8913151}),g=new l.nvb(1,1,1);return At=new l.Kj0(g,[d,u,p,h,m,f]),setTimeout((function(){Dt()}),1),kt}function Ft(e){e&&!Mt&&(Mt=new It.O(vt,it))}function Bt(e,n,t,i){_t.load("./"+e,(e=>{let o;if(e.scene.rotation.x=Math.PI/2,e.scene.traverse((function(e){e instanceof l.Kj0&&(o=e,t||(e.material=i?new l.Wid({color:i,metalness:0,roughness:1}):new l.Wid({vertexColors:l.jSK,metalness:0,roughness:1}),e.material.needsUpdate=!0))})),e.scene.children[0],o){var a=e.animations;if(a&&a.length){Et=new l.Xcj(o);for(var r=0;r<a.length;r++){var s=a[r];let e=Et.clipAction(s);e.timeScale=.002,e.play()}}}n(e.scene)}),(e=>{console.log(e.loaded/e.total*100+"% loaded")}),(e=>{console.error("An error happened",e)}))}function qt(){window.screen.width>window.innerWidth?(xt=window.innerWidth,bt=window.innerHeight):(xt=window.screen.width,bt=window.screen.height),ft.aspect=xt/bt,ft.updateProjectionMatrix(),gt.setPixelRatio(.5),gt.setSize(xt,bt)}function Dt(e){!function(){it.step(.03333333333333333);for(var e=0;e!==tt.length;e++){if(null!=tt[e].id){let n=ct[tt[e].id];n.position.copy(tt[e].position),n.quaternion.copy(tt[e].quaternion)}tt[e].position.z<-100&&(tt[e].position.set(80*Math.random()-40,80*Math.random()-40,100),tt[e].velocity.set(0,0,0),tt[e].collisionResponse=!1,tt[e].sleep())}let n=Zn(),t=ot.velocity.length();ei.left?(t<2&&(ot.velocity.x-=2*Math.cos(n),ot.velocity.y-=2*Math.sin(n)),rt=n+Math.PI/2,ot.quaternion.setFromAxisAngle(new at.Vec3(0,0,1),rt)):ei.right?(t<2&&(ot.velocity.x+=2*Math.cos(n),ot.velocity.y+=2*Math.sin(n)),rt=n-Math.PI/2,ot.quaternion.setFromAxisAngle(new at.Vec3(0,0,1),rt)):ei.up?(t<2&&(ot.velocity.x-=2*Math.sin(n),ot.velocity.y+=2*Math.cos(n)),rt=n,ot.quaternion.setFromAxisAngle(new at.Vec3(0,0,1),rt)):ei.down&&(t<2&&(ot.velocity.x+=2*Math.sin(n),ot.velocity.y-=2*Math.cos(n)),rt=n+Math.PI,ot.quaternion.setFromAxisAngle(new at.Vec3(0,0,1),rt)),zt.position.copy(ot.position),zt.quaternion.copy(ot.quaternion)}(),yt.rotation.z>Math.PI/16||(yt.rotation.z,Math.PI),function(){var e=new l.Pa4;e.set(qn()/window.innerWidth*2-1,-Dn()/window.innerHeight*2+1,.5),e.unproject(ft);var n=e.sub(ft.position).normalize(),t=-ft.position.z/n.z,i=ft.position.clone().add(n.multiplyScalar(t));Ct.position.x=i.x,Ct.position.y=i.y,Ct.position.z=2,jn(Ct.position)}(),function(){Ge+=Je,Ge<0?(Ge=0,Je=-Je):Ge>1&&(Ge=1,Je=-Je),Ge&&(Re.color.setHex(16777215),De.color.setHex(6316128),Xt(11594237,1));let e=Ye*Ge;Be.position.y=qe.y-e,Re.position.y=qe.y+e}(),Mt&&Mt.update(),gt.render(Jt,wt),requestAnimationFrame(Dt)}function Ot(e,n){gt.setSize(256,256),gt.setClearColor(16777215,0),e&&n?gt.render(e,n):gt.render(getScene(),ft);let t=gt.domElement.toDataURL();return gt.setSize(xt,bt),t}function Wt(e){yt.add(e)}function jt(e){vt.add(e)}function Vt(e){yt.remove(e)}function Ut(e,n,t,i,o,a,r){let s=new l.nvb(e,n,t);r||(r=Lt);let c=new l.Kj0(s,r);return c.castShadow=!0,c.position.x=i||0,c.position.y=o||0,c.position.z=a||0,c}function Yt(e,n,t,i,o,a,r){return Ut(e,n,t,i,o,a,r=r?new l.vBJ({color:r}):Lt)}function Gt(e,n,t,i,o,a,r){let s=new l.fHI(e,n,t,6);r=r?new l.vBJ({color:r}):Lt,s.rotateX(Math.PI/2),s.rotateZ(Math.PI/2);let c=new l.Kj0(s,r);return c.castShadow=!0,c.position.x=i||0,c.position.y=o||0,c.position.z=a||0,c}var Jt=0;function Xt(e,n){gt.setClearColor(e,n)}function Kt(){return new l.ZAu}let Zt;function Qt(e,n,t,i){let o,a=document.createElement("div"),r=document.createElement("div");if(r.classList.add("switch"),t&&(o=settingsObject[t]),i){o!=i[0]&&(o!=i[i.length-1]?r.classList.add("switchHalf"):r.classList.add("switchOn")),r.setAttribute("value",o);let e=0;for(let n=0;n<i.length;n++)i[n]==o&&(e=n);r.setAttribute("index",e),r.addEventListener("click",(function(e){e.stopPropagation();let t=r.getAttribute("index");t++,t>=i.length&&(t=0),0==t?r.classList.remove("switchOn"):t==i.length-1?(r.classList.remove("switchHalf"),r.classList.add("switchOn")):r.classList.add("switchHalf");let o=i[t];r.setAttribute("value",o),r.setAttribute("index",t),n(o)}))}else o&&r.classList.add("switchOn"),r.addEventListener("click",(function(e){e.stopPropagation(),r.classList.contains("switchOn")?(r.classList.remove("switchOn"),n(!1)):(r.classList.add("switchOn"),n(!0))}));a.appendChild(r);let l=document.createElement("span");l.innerHTML=e,a.appendChild(l),Zt.appendChild(a),n(o)}var $t,ei;$t=document.querySelector("#main"),ei={},function(e){var n;(n=document.createElement("style")).innerHTML='\n\t\t.uiSysTop{\n\t\tdisplay: flex;\n\t\talign-items: flex-start;\n\t\tposition: relative;\n\t\tmax-width: 600px;\n\t\theight: 64px;\n\t\tborder-radius: 32px;\n\t\ttransform: translate(-50%);\n\t\tbox-shadow: 3px 3px 3px #0005;\n\t\tleft: 50%;\n\t\tbackground: #E0F9D5;\n\t\tmargin: 12px;\n\t\tanimation: uiSysUnfold 1s;\n\t\toverflow: hidden;\n\t\tline-height: 16px;\n\t}\n\t.uiSysTop div{\n\n\t\tmargin: 16px;\n\t\tmargin-left: 0px;\n\t\tflex: 0 0 64px;\n\t}\n\t.uiSysTop span{\n\t\tmargin-right: 48px;\n\t\tmargin-top: 8px;\n\t\tline-height: normal;\n\t\tvertical-align: middle;\n\t\tflex: 1;\n\n\t}\n\t@keyframes uiSysUnfold{\n\t\t0%{\n\t\t\tmax-width: 64px;\n\t\t\ttop: -64px;\n\t\t\topacity: 0.2;\n\t\t}\n\t\t50%{\n\t\t\tmax-width: 64px;\n\t\t\ttop:0px;\n\t\t\topacity: 1;\n\t\t}\n\t\t100%{\n\t\t\ttop: 0px;\n\t\t}\n\t}\n\t@keyframes uiSysFold{\n\t\t100%{\n\t\t\tmax-width: 64px;\n\t\t\ttop: -64px;\n\t\t\topacity: 0.2;\n\t\t\theight: 0;\n\t\t}\n\t\t50%{\n\t\t\tmax-width: 64px;\n\t\t\ttop:0px;\n\t\t\topacity: 1;\n\t\t}\n\t\t0%{\n\t\t\ttop: 0px;\n\n\t\t}\n\t}\n\t@keyframes uiSysMini{\n\t\t100%{\n\t\t\tmax-width: 64px;\n\t\t}\n\t\t50%{\n\t\t\tmax-width: 64px;\n\n\t\t}\n\t\t0%{\n\t\t\t\n\t\t}\n\t}\n\t@keyframes uiSysMax{\n\t\t0%{\n\t\t\tmax-width: 64px;\n\t\t}\n\t\t50%{\n\t\t\tmax-width: 64px;\n\t\t}\n\t\t100%{\n\t\t\tleft: 50%;\n\t\t}\n\t}\n\n\t.uiHolderSysTop{\n\t\twidth: 600px;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%);\n\t\t/*border: 3px #0999 dotted;*/\n\t\ttransition: height 1s;\n\t}\n\t.uiIcon{\n\t\tfloat: left;\n\t\twidth: 32px;\n\t\theight: 32px;\n\t\tbackground-repeat: no-repeat;\n\t    background-size:32px;\n\t    background-position: center center;\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 9h-2V5h2v6zm0 4h-2v-2h2v2z"/></svg>\');\n\t}\n\t.uiIconWarning{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>\') !important;\n\t}\n\t.uiIconError{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>\') !important;\n\t}\n\t.uiIconNet{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M23.64 7c-.45-.34-4.93-4-11.64-4-1.5 0-2.89.19-4.15.48L18.18 13.8 23.64 7zm-6.6 8.22L3.27 1.44 2 2.72l2.05 2.06C1.91 5.76.59 6.82.36 7l11.63 14.49.01.01.01-.01 3.9-4.86 3.32 3.32 1.27-1.27-3.46-3.46z"/></svg>\') !important;\n\t}\n\t.uiIconPerson{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>\') !important;\n\t\t\n\t}\n\t.uiIconTime{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>\') !important;\n\t}\n\n\t.uiIconSuccess{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>\') !important;\n\t}\n\t\n\t.uiCloseButton{\n\t\tposition: absolute;\n\t\tright: 0;\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tbackground-repeat: no-repeat;\n\t    background-size:16px;\n\t    background-position: center center;\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>\');\n\t\t\n\t}\n\n\t.uiCursorMessage{\n\t\tmin-width: 64px;\n\t\theight: 64px;\n\t\tborder: 5px solid white;\n\t\tbackground-color: #FBAB7E;\n\t\tbackground-image: linear-gradient(270deg, #FBAB7E 0%, #F7CE68 100%);\n\n\t\tcolor: white;\n\t\tfont-size: 24px;\n\t\tfont-weight: bold;\n\t\tfont-stretch: ultra-condensed;\n\t\ttransform: translate(-50%,-50%);\n\t\tanimation: uiWobble 0.3s;\n\t\tborder-radius: 32px;\n\t\tbox-sizing: border-box;\n\t\tposition: absolute;\n\t\tline-height: 48px;\n\t\tpadding: 0 8px 0 8px;\n\t\tfont-family: sans-serif;\n\t}\n\n\t@keyframes uiWobble{\n\t\t0%{\n\t\t\ttransform: translate(-50%,-50%) scale(0.6,0.4);\n\t\t}\n\t\t33%{\n\t\t\ttransform: translate(-50%,-50%) scale(0.9,1.15);\n\t\t}\n\t\t66%{\n\t\t\ttransform: translate(-50%,-50%) scale(0.8,0.9);\n\t\t}\n\t\t100%{\n\n\t\t}\n\t}\n\n\t@keyframes uiFade{\n\t\t0%{\n\t\t\topacity: 1;\n\t\t\ttransform: translate(-50%,-50%);\n\t\t}\n\t\t100%{\n\t\t\topacity: 0;\n\t\t\ttransform: translate(-50%,0%)\n\t\t}\n\t}\n\n\t.confetti{\n\t\tpointer-events: none;\n\t\tleft:200px;\n\t\ttop:200px;\n\t\twidth:50px;\n\t\theight:50px;\n\t\tposition: absolute;\n\t\tstroke-width:40px;\n\t\t/*background-image: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewbox="0 0 100 100" style="fill:none;stroke:lightgray;stroke-linecap:round;"><path d="M45 65L75 75M45 50L75 50M45 35L75 25" /></svg>\');\n\t\tbackground-size: cover;\n\t\tbackground-position: center;\n\t  \tbackground-repeat: no-repeat;*/\n\t}\n\t.confetti svg{\n\t\tposition: relative;\n\t\tanimation: dooter 0.5s forwards;\n\t\ttransform: translate(-50%,-50%);\n\t\twidth: 50px;\n\t\theight: 50px;\n\t}\n\t@keyframes dooter{\n\t\tfrom{\n\t\t\ttransform: translate(0%,0%) scale(0.1,0.1);\n\t\t\tstroke-width:30;\n\t\t}\n\t\tto{\n\t\t\ttransform: translate(100%,0%) scale(3,3);\n\t\t\tstroke-width:0;\n\t\t\tfilter:hue-rotate(270deg);\n\t\t}\n\t}\n\n\t',document.body.appendChild(n),e?m=e:(m=document.querySelector("#main"),m||(m=document.body)),m?(f=document.createElement("div"),f.className="uiHolderSysTop",m.appendChild(f),g=document.createElement("input"),g.type="text",g.style.position="fixed",g.taxindex="-1",g.style.display="none",g.style.pointerEvents="none",m.appendChild(g)):console.error("UI.js:: uh oh! no system dom element found")}($t),window.onError=function(e,n,t,i,o){v(e,"error")},function(){tt=[],(it=new at.World).quatNormalizeSkip=0,it.quatNormalizeFast=!1,it.allowSleep=!0,it.gravity.set(0,0,-10),it.broadphase=new at.NaiveBroadphase;let e=new at.Box(new at.Vec3(1,1,2));for(let n=0;n<1;n++){let n=new at.Body({mass:4});n.addShape(e),n.position.set(0,0,60),it.addBody(n),ot=n,window.playerBody=ot}new at.Material({name:"gooProperty",friction:10,restitution:-1}).name="gooProperty",new at.Material({name:"wallProperty",friction:.1,restitution:1}).name="wallProperty",function(){let e=new at.Plane,n=new at.Body({mass:0});n.addShape(e),it.addBody(n)}()}(),Rt(),Bt("./assets/models/Hex.glb",(e=>{console.log("got children "+e.children.length);let n=new l.Wid({vertexColors:l.jSK,metalness:0,roughness:1});for(let t=0;t<e.children.length;t++){let i=e.children[t];i.position.set(0,0,60),i.scale.set(8,8,8),i.material=n,i.receiveShadow=!0,(i.name.startsWith("Mount")||i.name.startsWith("Tree")||i.name.startsWith("House"))&&(i.castShadow=!0),be[i.name]=i;let o=[];if(i.geometry){let e=i.geometry.attributes.color.array.length/4;for(let n=0;n<e;n++){let e=4*n,t=d(i.geometry.attributes.color.array[0+e],i.geometry.attributes.color.array[1+e],i.geometry.attributes.color.array[2+e]);o[t]=t}}}function t(e,n){e.addEventListener("click",(e=>{console.log("clicking hex");let t=e.target;t.classList.contains("hex")||(t=t.parentElement),t.classList.remove("jelloAnim"),t.offsetWidth,t.classList.add("jelloAnim"),function(e){ze=e,console.log("set hex "+ze)}(n)}))}let i=document.querySelectorAll(".hex");i[0].appendChild(p(je("Grass_O1"))),t(i[0],1),i[1].appendChild(p(je("Tree_N"),75,-75)),t(i[1],4),i[2].appendChild(p(je("Grass_P1"))),t(i[2],2),i[3].appendChild(p(je("Mount_N"),90)),t(i[3],3),i[4].appendChild(p(je("Water_N"))),t(i[4],0),i[5].appendChild(p(je("House_N"))),t(i[5],5),function(){Ae();for(let e=0;e<32;e++){Ee[e]=[];for(let n=0;n<32;n++)Ee[e][n]=1}}(),Te()})),function(){let e=new l.vBJ({color:4907322}),n=new l.ZAu,t=new l.BKK(.6,8),i=new l.Kj0(t,e);i.position.set(8,0,0),n.add(i);for(let e=0;e<6;e++){let t=i.clone();t.rotation.z=e*Math.PI/3,t.position.set(8*Math.cos(t.rotation.z),8*Math.sin(t.rotation.z),0),n.add(t)}n.position.z+=6,Wt(n),(ke=n).visible=!1}(),function(){let e=8*Math.sqrt(3)/2;var n=new l.ZXM;for(let t=0;t<32;t++)for(let i=0;i<32;i++)n.vertices.push(new l.Pa4(-48+e+t*e*2+i*e,8*i*1.5-4,.8)),n.vertices.push(new l.Pa4(-48+e+t*e*2+i*e,4+8*i*1.5,.8)),n.vertices.push(new l.Pa4(-48+e+t*e*2+i*e,4+8*i*1.5,.8)),n.vertices.push(new l.Pa4(t*e*2-48+i*e,8+8*i*1.5,.8)),n.vertices.push(new l.Pa4(t*e*2-48+i*e,8+8*i*1.5,.8)),n.vertices.push(new l.Pa4(-48-e+t*e*2+i*e,4+8*i*1.5,.8));var t=new l.nls({color:16777215});Le=new l.ejS(n,t)}(),function(){a=new l.xsS,(r=new l.cPb(45,1,1,1e3)).position.z=200,r.position.y=-200,r.up=new l.Pa4(0,0,1),r.lookAt(new l.Pa4(0,0,0));var e=new l.Mig(9408399);a.add(e)}(),function(e){(C=document.querySelector("#closeCard")).addEventListener("click",(e=>{R()}));let n=document.querySelectorAll(".card");b=[],n.forEach((e=>{b.push(e)})),b.forEach(((e,n)=>{e.style.top=Math.random()*window.innerWidth+"px",e.style.left=Math.random()*window.innerHeight+"px",e.offset={x:0,y:0},e.appId=n,e.addEventListener("pointerdown",(n=>{!function(e,n){e.focused||(N=e,e.pos={x:parseInt(e.style.left),y:parseInt(e.style.top)},H={x:e.pos.x,y:e.pos.y},e.offset={x:e.pos.x-n.clientX,y:e.pos.y-n.clientY},e.classList.add("cardMove"),e.moving=void 0)}(e,n)})),e.addEventListener("dragstart",(e=>{e.preventDefault()}))})),window.addEventListener("pointerup",j),window.addEventListener("resize",F),window.addEventListener("pointermove",O),function(){_=document.querySelector("#bar");let e=document.querySelector("#barHandle");e.addEventListener("pointerdown",(e=>{T=!0})),e.addEventListener("dragstart",(e=>{e.preventDefault()})),L=[],e.style.transform="translate(-50%,-200%)",_.style.left="50%",_.style.top=window.innerHeight-64+"px",B(!0)}(),F(),q()}(),function(){var e;(e=document.createElement("style")).innerHTML="\n        .list-item{\n            border-radius: 16px;\n            background-color: white;\n            box-shadow: 6px 16px 1px #0005;\n            max-width: calc(100% - 128px);\n            transform: translate(-50%,0);// rotate3d(1,0,0,0deg);\n            margin: 32px 0 16px 0;\n            position: relative;\n            padding: 16px;\n            left: 50%;\n            font-weight: bold;\n            font-size: 2em;\n            text-shadow: 1px 1px 2px black;\n            text-align: center;\n            font-family: 'openBold', serif;\n            transition: 0.2s transform;\n\n        }\n        .list-item span{\n            margin: 32px 0 32px 0;\n        }\n        .list-item:hover{\n            transform: translate(-50%,0) scale(1.05,1.05);// rotate3d(1,0,0,0deg);\n        }\n        .list{\n            width: 100%;\n            height: 100%;\n            position: absolute;\n            overflow-y: scroll;\n        }\n        .list *{\n            user-select: none;\n        }\n        .list-portrait{\n            left: 8px;\n            top: 8px;\n            position: absolute;\n            display: inline-block;\n            width: 64px;\n            height: 64px;\n            border-radius: 32px;\n            background-color: white;\n            box-shadow: 6px 16px 1px #0005;\n            overflow: hidden;\n            box-sizing: border-box;\n            border: white solid 6px;\n            transform: translate(-50%,-50%);\n            transition: left 0.4s;\n        }\n        .bigger-item .list-portrait{\n            left: 50% !important;\n            top: 0px !important;\n        }\n        .login-popin{\n            position: fixed;\n            border-radius: 16px;\n            background-color: white;\n            box-shadow: 6px 16px 1px #0005;\n        }\n        #login-junk{\n            max-width: 500px;\n            height: 300px;\n            transform: translate(-50%,0);\n            position: relative;\n            left: 50%;\n        }\n        .num{\n            margin-left: 0 !important;\n            border-radius: 28px;\n            font-size: 36px;\n            background-color: #0005;\n            width: 56px;\n            height: 56px;\n            display: inline-block;\n            overflow: hidden;\n            cursor: pointer;\n        }\n        .num-row{\n            width: 168px;\n            height: 168px;\n            position: absolute;\n            left: 50%;\n            transform: translate(-50%,0);\n        }\n        input{\n            text-align: center;\n            font-size: 16px;\n            outline: none;\n            border: none;\n            border-bottom: black 6px solid;\n            margin: 16px;\n            background-color: transparent;\n            color: inherit;\n        }\n        ",document.body.appendChild(e);let n=document.querySelector("#login-junk");n.style.display="none";let t=document.createElement("div");t.className="list",x=n.querySelector("input"),(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))&&x.setAttribute("readonly","readonly"),function(e){let n=document.createElement("div");n.className="num-row";for(let e=1;e<=10;e++){let t=document.createElement("div");t.innerText=10==e?0:e,t.className="num",n.appendChild(t),t.addEventListener("click",(e=>{e.stopPropagation(),x.value.length<4&&(x.value+=e.target.innerText)}))}let t=document.createElement("div");t.className="num",t.innerText="C",t.addEventListener("click",(e=>{e.stopPropagation(),x.value=""})),n.appendChild(t);let i=document.createElement("div");i.className="num",i.innerText="Go",i.style.backgroundColor="#fff5",i.addEventListener("click",(e=>{e.stopPropagation();let n=e.target.parentElement.parentElement.parentElement.querySelector("span");var t,i;n&&(console.log("login with ",n.innerText,":",x.value),t=n.innerText,i=x.value,fetch("/login",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:i})}).then((function(e){return e.ok?e.json():void v(e.status+":"+e.statusText,"warn")})).then((function(e){e&&(v(e.message,"success"),function(e){if(!(w=y[e]))throw new Error("player doesn't exist")}(e.id),window.m=we,console.log("trying auth..."),ge=v("attempting communications...","net",!0),(se=h("/dand-dev")).on("connect",(function(){document.querySelector("#login-menu").style.display="none",console.log("connected"),se.emit("physInit"),ge.remove(),ge=void 0})),se.on("event",(function(e){})),se.on("disconnect",(function(e){console.log("disconnected ",e),e.includes("disconnect")?document.querySelector("#login-menu").style.display="block":ge=v("lost connection, attempting reconnection...","net",!0)})),se.on("message",(function(e,n){pe(e,n)})),se.on("join",(function(e){me(e+" has joined!")})),se.on("terrain",(function(e,n,t){Ve(0,t)})),se.on("sendPhys",(function(e,n){!function(e,n){let t=st[e.id];t&&(t.position.copy(e.position),t.quaternion.copy(e.quaternion),n?t.sleep():(t.velocity.copy(e.velocity),t.angularVelocity.copy(e.angularVelocity),t.wakeUp()))}(e,n)})),se.on("physUpdate",(function(e){ve?(ut(e),console.log("phys synced")):console.log("!!!phys IGNORED")})),se.on("physInit",(function(e,n){ct.forEach((e=>{Vt(e)})),ct=[],tt.forEach((e=>{it.remove(e)})),tt=[],lt=[],st=[],e.forEach(((e,n)=>{dt(e[0],e[1],e[2],{x:0,y:0,z:0},{x:0,y:0,z:0,w:0},e[3],e[4],e[5])})),ut(n),ve=!0})),se.on("physMake",(function(e,n,t,i,o,a,r,l){dt(e,n,t,i,o,a,r,l),console.log("made")})),fetch("/lastChats",{method:"post",headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():void 0})).then((function(e){e&&(e.array.forEach((e=>{pe(e[0],e[1])})),me("Last 10 messages"))})).catch((e=>{v(e,"error"),console.error("ERROR ",e)})),fetch("/grid",{method:"post",headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():void 0})).then((function(e){e&&e.grid.length>0&&Ve(0,e.grid)})).catch((e=>{v(e,"error"),console.error("ERROR ",e)})),Sn())})).catch((e=>{v(e,"error"),console.error("ERROR ",e)})))})),n.appendChild(i),e.appendChild(n)}(n);let i=document.querySelector("#login-menu");i.appendChild(t),i.appendChild(n),fetch("/getUsers",{method:"post"}).then((function(e){return e.json()})).then((function(e){e&&(function(e){y=[],e.forEach((e=>{y[e.id]=e}))}(e.users),e.users.forEach((e=>{let n=document.createElement("div");n.className="list-item";let i=e.color;n.style.backgroundColor=i;let o=u(s(i));n.style.color=o?"#000000":"#FFFFFF",n.style.textShadow="1px 1px 2px "+(o?"#FFFFFF":"#000000"),n.addEventListener("click",(e=>{let t=document.querySelector("#login-junk");t.style.display="",t.parentElement.classList.remove("bigger-item"),n.appendChild(t),n.classList.add("bigger-item"),e.stopPropagation(),x.focus()}));let a=document.createElement("div");a.className="list-portrait",n.appendChild(a);let r=document.createElement("span");r.innerText=e.username,n.appendChild(r),t.appendChild(n)})))})).catch((e=>{console.error("ERROR"+e)}))}(),function(){let e=document.querySelector("#chatCard");(J=document.createElement("div")).classList.add("chat-pane"),e.appendChild(J),(K=document.createElement("div")).classList.add("chat-bottom"),X=document.createElement("input");let n="0xffff55";n="#"+n.substring(2,n.length),X.style.border=n+" 6px solid",K.appendChild(X),function(e,n){let t=re("drawer-opener");t.setAttribute("status","chat"),t.addEventListener("click",(n=>{let t=e.querySelector(".drawer-group");t&&"initial"==t.style.display?(t.style.display="none",G=void 0):(U.style.display="initial",e.appendChild(U),G=n.target.getAttribute("status"))})),e.appendChild(t)}(K),e.appendChild(K),X.addEventListener("keyup",(function(e){if(13==e.which)if(X.value.length>0||"chat"==le()){let e="";"chat"==le()&&(e+=Y.toDataURL("image/png")+"#",U.style.display="none",G=void 0),e+=X.value,n=e,se.emit("message",n),X.value=""}else setTimeout(he,20);else 27==e.which&&he();var n})),document.createElement("div").classList.add("letterPane")}(),Zt=document.querySelector(".settingsPane"),Qt("Toggle Hex Grid Lines",(function(e){e?Wt(Le):Vt(Le)})),Qt("Toggle Light Helper",Ke),Qt("Toggle Physics Mesh Helper",Ft),$e=document.querySelector("#makerBar"),cn.forEach((e=>{!function(e){let n=function(e){let n=document.createElement("div");return n.className="makerIcon",n}();n.setAttribute("data",e),n.addEventListener("click",(e=>{en=e.target.getAttribute("data")})),n.innerText=e,$e.appendChild(n)}(e)})),rn("pot"),rn("rock"),an("assets/models/man.gltf",((e,n)=>{var t;e=e.children[0],(Ze=e).castShadow=!0,Ze.receiveShadow=!0,e.scale.set(2,2,2),n&&n.forEach((e=>{e.name&&(tn[e.name]=e)})),ln(e,[1,.2541521191596985,.022173885256052017],[0,0,1]),new l.Pa4(0,0,1),(t=l.rDY.merge([l.Vj0.phong.uniforms,{shirt:{value:new l.Pa4(0,1,0)},wind:{value:new l.Pa4(0,0,0)}}])).ambientLightColor.value=null,(Qe=new l.jyz({uniforms:t,derivatives:!1,lights:!0,vertexColors:!0,vertexShader:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nuniform vec3 shirt;\nuniform vec3 wind;\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #ifdef USE_COLOR\n        if(color==vec3(0,0,1))\n            vColor.xyz = shirt;\n        else\n            vColor.xyz = color.xyz;\n        \n    #endif\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n    #ifdef USE_TANGENT\n        vTangent = normalize( transformedTangent );\n        vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n    #endif\n#endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    \n        if(color==vec3(1,0,0)){\n            float val=max(0.0, 1.0976 - transformed.z);\n            transformed.xyz+=val*wind;\n            transformed.y*=1.0+sin((wind.z+transformed.z)*4.0)/2.0;\n\n        }\n    \n\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n}",fragmentShader:"\n    #define STANDARD\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n    #define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n    uniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n    #ifdef TRANSPARENCY\n        diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n    #endif\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}"})).needsUpdate=!0,Qe.skinning=!0,on.man=Ze,Qe.onBeforeCompile=e=>{e.uniforms.shirt=man.children[1].material.uniforms.shirt,e.vertexShader="uniform vec3 shirt;\n"+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <color_vertex>","\n                #ifdef USE_COLOR\n                    if(color.xyz == vec3(0,0,1)){\n                        vColor.xyz = vec3(1,1,0);\n                    }else{\n                        vColor.xyz = color.xyz;\n                    }\n                #endif")}})),an("assets/models/gran.gltf",((e,n)=>{(e=e.children[0]).castShadow=!0,e.receiveShadow=!0,e.scale.set(2,2,2),ln(e,[.42869052290916443,.262250691652298,.4677838087081909],[0,0,1]),new l.Pa4(0,0,1),on.gran=e})),function(){var e;(e=document.createElement("style")).innerHTML='\n.drawer-group{\n    position: absolute;\n    top: -204px;\n    width: 128px;\n    left: 50%;\n    transform: translate(-50%,0);\n}\n.drawer {\n    display:block;\n    width: 128px;\n    height: 128px;\n    position: relative;\n    border-radius: 8px;\n    border: gray solid 1px;\n    image-rendering: pixelated;\n    touch-action: none;\n}\n\n.drawer-top{\nposition: relative;\npointer-events: none;\n}\n.drawer-top *{\n    pointer-events: initial;\n}\n\n.drawer-paint,\n.drawer-trash,\n.drawer-download {\n    width: 24px;\n    height: 24px;\n    border-radius: 12px;\n    display: inline-block;\n    border: gray solid 1px;\n    box-sizing: border-box;\n    animation: 0.2s;\n}\n\n\n.drawer-trash {\n    border: none;\n    background-position: center center;\n    background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>\');\n}\n\n.drawer-download {\n    border: none;\n    background-size: cover;\n    background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 5v11.17l-4.88-4.88c-.39-.39-1.03-.39-1.42 0-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0l6.59-6.59c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0L13 16.17V5c0-.55-.45-1-1-1s-1 .45-1 1z"/></svg>\');\n}\n.drawer-opener{\n    width:48px;\n    height: 48px;\n    border-radius:24px;\n    background-color: white;\n    position: relative;\n    display: inline-block;\n    background-size: 32px;\n    background-position: center center;\n    background-repeat: no-repeat;\n\n    background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.9 13.98l2.1 2.53 3.1-3.99c.2-.26.6-.26.8.01l3.51 4.68c.25.33.01.8-.4.8H6.02c-.42 0-.65-.48-.39-.81L8.12 14c.19-.26.57-.27.78-.02z"/></svg>\');\n}\n.stretch-image{\n    width: 64px;\n    height 64px;\n}\n',document.body.appendChild(e),U=document.querySelector(".drawer-group"),(Y=U.querySelector(".drawer")).setAttribute("width","32px"),Y.setAttribute("height","32px"),Y.addEventListener("pointerdown",$),Y.addEventListener("pointermove",ee),window.addEventListener("pointerup",ne),(V=Y.getContext("2d")).imageSmoothingEnabled=!1;let n=U.querySelector(".drawer-top"),t=re("drawer-paint");t.style.backgroundColor="black",t.addEventListener("pointerup",ae);let i=re("drawer-paint");i.style.backgroundColor="red",i.addEventListener("pointerup",ae);let o=re("drawer-paint");o.style.backgroundColor="#65BB00",o.addEventListener("pointerup",ae);let a=re("drawer-paint");a.style.backgroundColor="white",a.addEventListener("pointerup",ae);let r=re("drawer-download");r.addEventListener("pointerup",ie);let l=re("drawer-trash");l.addEventListener("pointerup",te),n.appendChild(t),n.appendChild(i),n.appendChild(o),n.appendChild(a),n.appendChild(r),n.appendChild(l),document.onpaste=function(e){var n=(e.clipboardData||e.originalEvent.clipboardData).items;let t;for(t in console.log(JSON.stringify(n)),n){var i=n[t];if("file"===i.kind){var o=i.getAsFile(),a=new FileReader;a.onload=function(e){var n=new Image;n.onload=function(){V.fillStyle="rgba(255, 255, 255, 0)",V.drawImage(n,0,0,32,32)},n.src=e.target.result},a.readAsDataURL(o)}}}}()}},0,[[285,666,977]]]);