(self.webpackChunkbuup=self.webpackChunkbuup||[]).push([[179],{224:(e,n,t)=>{"use strict";t.d(n,{a:()=>mi});var i={};t.r(i),t.d(i,{x0:()=>ot,_O:()=>et,S1:()=>Hn,Z2:()=>tt,Qc:()=>it,Jz:()=>Xn,A$:()=>Fn,V8:()=>Gn,KT:()=>Jn,LP:()=>Bn,_:()=>Dn,W1:()=>Rn,D9:()=>Kn});var o={};t.r(o),t.d(o,{vw:()=>_t,_h:()=>wt,Or:()=>gt,UI:()=>ht,Fx:()=>bt,uY:()=>Et,S1:()=>dt,Es:()=>mt,Wb:()=>yt,ae:()=>ft,yQ:()=>ct,rr:()=>at});var a={};t.r(a),t.d(a,{mS:()=>Zt,n6:()=>Qt,UX:()=>Kt,bK:()=>ni,GI:()=>ti,pk:()=>Dt,S1:()=>Ut,u7:()=>Gt,b5:()=>ai,hM:()=>Rt,gw:()=>$t,SI:()=>Jt,ob:()=>oi,j3:()=>Yt});var r=t(642);function l(e){"string"!=typeof e&&(e=e.toString(16)),e.startsWith("#")?e=e.substring(1):e.startsWith("0x")&&(e=e.substring(2));let n=0,t=0,i=0;return 3==e.length?(n="0x"+e[0]+e[0],t="0x"+e[1]+e[1],i="0x"+e[2]+e[2]):6==e.length&&(n="0x"+e[0]+e[1],t="0x"+e[2]+e[3],i="0x"+e[4]+e[5]),[parseInt(n),parseInt(t),parseInt(i)]}function s(e){var n=e.toString(16);return 1==n.length?"0"+n:n}function d(e,n,t){return function(e,n,t){return"#"+s(e)+s(n)+s(t)}(e=Math.floor(256*e),n=Math.floor(256*n),t=Math.floor(256*t))}function c(e){let n=.299*e[0]+.587*e[1]+.114*e[2];return console.log(n),n>186}var p,u,m,h,f=t(429),g=0,v={},x={};function w(e,n){g++,Gt(e,((e,t)=>{g--,n(e,t)}))}function y(e){w("assets/models/"+e+".gltf",(n=>{n.scale.set(2,2,2),n.castShadow=!0,n.receiveShadow=!0,function(e,n){let t=e.replace(/[0-9]/g,"");if(t!=e)if(x[t]){if(!Array.isArray(x[t])){let e=x[t];x[t]=[e]}x[t].push(n)}else x[t]=n;x[e]=n}(e,n)}))}function b(e,n,t){if(e.geometry)_(e,e.geometry,n,t);else if(e.children&&e.children.length>0)for(let i=0;i<e.children.length;i++)e.children[i].geometry&&_(e,e.children[i].geometry,n,t)}function _(e,n,t,i){if(!n)return;let o,a=t&&i,r=n.attributes.color.array,l=[];for(let e=0;e<r.length;e++)if(o=e%4,o>=3)if(a)r[e-3]==t[0]&&r[e-2]==t[1]&&r[e-1]==t[2]&&(r[e-3]=i[0],r[e-2]=i[1],r[e-1]=i[2]);else{let n=d(r[e-3],r[e-2],r[e-1]);l[n]=r[e-3]+","+r[e-2]+","+r[e-1]}a||Object.keys(l).forEach((t=>{console.log("%s %s %c %s %c %s",e.name,n.name,"background: "+t+"; color: #000",t,"background: white;",l[t])}))}function E(e,n){let t=x[e];if(t){if(Array.isArray(t))t=t[Math.floor(Math.random()*t.length)];else if(("man"==e||"gran"==e)&&n){t=f.b.clone(t);let e=l(n).map((e=>e/256));return t.userData.shirt={value:new r.Pa4(e[0],e[1],e[2])},t.userData.wind={value:new r.Pa4(0,1,0)},t.children.forEach((e=>{e&&"SkinnedMesh"==e.type&&(e.castShadow=!0,e.receiveShadow=!0,"Gran"!=e.name&&"Man"!=e.name&&"GranHead"!=e.name||(console.log("skinned ",e.name),e.material=u.clone(),e.material.skinning=!0,e.material.needsUpdate=!0,e.material.uniforms.shirt=t.userData.shirt),e.name)})),t}return t.clone()}return Dt.clone()}var k=[];function L(e,n,t){n?e.scale.set(n,n,n):e.scale.set(110,110,110),t?e.position.set(0,0,t):e.position.set(0,0,-30),m.add(e);let i=Kt(m,h);return m.remove(e),i}function S(e,n,t){let i=document.createElement("img");return i.className="hexPortrait",i.setAttribute("src",L(e,n,t)),i}var C=t(321);let z,T,A;function M(e,n,t){let i=document.createElement("div");i.className="uiSysTop";let o=document.createElement("div"),a=" ";if("object"==typeof n&&null!==n)n.type&&(a+=n.type),n.color&&(i.style.backgroundColor=n.color);else switch(n){case"warn":a+="uiIconWarning",i.style.backgroundColor="#EFEF79";break;case"error":a+="uiIconError",i.style.backgroundColor="#D25E5E";break;case"net":a+="uiIconNet",i.style.backgroundColor="#FFC65E";break;case"person":a+="uiIconPerson",i.style.backgroundColor="#D257FF";break;case"time":a+="uiIconTime",i.style.backgroundColor="#5094D9";break;case"success":a+="uiIconSuccess",i.style.backgroundColor="#95F17F"}o.className="uiIcon"+a;let r=document.createElement("span");function l(){i.style.animation=t?"0.5s uiSysMini forwards":"0.5s uiSysFold forwards",setTimeout((function(){t?(i.style.position="absolute",i.style.left="-64px",i.addEventListener("click",(function(e){i.style.animation="0.5s uiSysMax forwards",setTimeout((function(){i.style.animation="0.5s uiSysMini forwards"}),3500)}))):i.remove()}),500)}if(r.innerText=e,r.addEventListener("click",(function(e){!function(e){A.value=e.innerText,A.style.display="block",A.select(),document.execCommand("copy"),A.blur(),A.style.display="none"}(r),function(e,n,t){let i=document.createElement("div");i.className="uiCursorMessage",i.style.left=e+"px",i.style.top=n+"px",i.innerText="Copied",z.appendChild(i),setTimeout((function(){i.style.animation="1s uiFade forwards",setTimeout((function(){i.remove()}),1e3)}),1500)}(e.clientX,e.clientY)})),i.appendChild(o),i.appendChild(r),!t){let e=document.createElement("div");e.className="uiCloseButton",i.appendChild(e),e.addEventListener("click",(function(e){l()}))}return setTimeout((function(){l()}),3500),T.appendChild(i),i}var N,P,H,I,R,q,F;function B(){return P}function D(){var e;(e=document.createElement("style")).innerHTML="\n        .list-item{\n            border-radius: 16px;\n            background-color: white;\n            box-shadow: 6px 16px 1px #0005;\n            max-width: calc(100% - 128px);\n            transform: translate(-50%,0);// rotate3d(1,0,0,0deg);\n            margin: 32px 0 16px 0;\n            position: relative;\n            padding: 16px;\n            left: 50%;\n            font-weight: bold;\n            font-size: 2em;\n            text-shadow: 1px 1px 2px black;\n            text-align: center;\n            font-family: 'openBold', serif;\n            transition: 0.2s transform;\n\n        }\n        .list-item span{\n            margin: 32px 0 32px 0;\n        }\n        .list-item:hover{\n            transform: translate(-50%,0) scale(1.05,1.05);// rotate3d(1,0,0,0deg);\n        }\n        .list{\n            width: 100%;\n            height: 100%;\n            position: absolute;\n            overflow-y: scroll;\n        }\n        .list *{\n            user-select: none;\n        }\n        .list-portrait{\n            left: 8px;\n            top: 8px;\n            position: absolute;\n            display: inline-block;\n            width: 64px;\n            height: 64px;\n            border-radius: 32px;\n            background-color: white;\n            box-shadow: 6px 16px 1px #0005;\n            overflow: hidden;\n            box-sizing: border-box;\n            border: white solid 6px;\n            transform: translate(-50%,-50%);\n            transition: left 0.4s;\n        }\n        .bigger-item .list-portrait{\n            left: 50% !important;\n            top: 0px !important;\n        }\n        .login-popin{\n            position: fixed;\n            border-radius: 16px;\n            background-color: white;\n            box-shadow: 6px 16px 1px #0005;\n        }\n        #login-junk{\n            max-width: 500px;\n            height: 300px;\n            transform: translate(-50%,0);\n            position: relative;\n            left: 50%;\n        }\n        .num{\n            margin-left: 0 !important;\n            border-radius: 28px;\n            font-size: 36px;\n            background-color: #0005;\n            width: 56px;\n            height: 56px;\n            display: inline-block;\n            overflow: hidden;\n            cursor: pointer;\n        }\n        .num-row{\n            width: 168px;\n            height: 168px;\n            position: absolute;\n            left: 50%;\n            transform: translate(-50%,0);\n        }\n        input{\n            text-align: center;\n            font-size: 16px;\n            outline: none;\n            border: none;\n            border-bottom: black 6px solid;\n            margin: 16px;\n            background-color: transparent;\n            color: inherit;\n        }\n        ",document.body.appendChild(e);let n=document.querySelector("#login-junk");n.style.display="none";let t=document.createElement("div");t.className="list",H=n.querySelector("input"),(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))&&H.setAttribute("readonly","readonly"),function(e){let n=document.createElement("div");n.className="num-row";for(let e=1;e<=10;e++){let t=document.createElement("div");t.innerText=10==e?0:e,t.className="num",n.appendChild(t),t.addEventListener("click",(e=>{e.stopPropagation(),H.value.length<4&&(H.value+=e.target.innerText)}))}let t=document.createElement("div");t.className="num",t.innerText="C",t.addEventListener("click",(e=>{e.stopPropagation(),H.value=""})),n.appendChild(t);let i=document.createElement("div");i.className="num",i.innerText="Go",i.style.backgroundColor="#fff5",i.addEventListener("click",(e=>{e.stopPropagation();let n=e.target.parentElement.parentElement.parentElement.querySelector("span");var t,i;n&&(console.log("login with ",n.innerText,":",H.value),t=n.innerText,i=H.value,fetch("/login",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:i})}).then((function(e){return e.ok?e.json():void M(e.status+":"+e.statusText,"warn")})).then((function(e){e&&(M(e.message,"success"),function(e){if(!(P=N[e]))throw new Error("player doesn't exist")}(e.id),window.m=He,console.log("trying auth..."),Me=M("attempting communications...","net",!0),(Ee=C("/dand-dev")).on("connect",(function(){document.querySelector("#login-menu").style.display="none",console.log("connected"),Ee.emit("physInit"),Me.remove(),Me=void 0})),Ee.on("event",(function(e){})),Ee.on("disconnect",(function(e){console.log("disconnected ",e),e.includes("disconnect")?document.querySelector("#login-menu").style.display="block":Me=M("lost connection, attempting reconnection...","net",!0)})),Ee.on("message",(function(e,n){Ce(e,n)})),Ee.on("join",(function(e){Te(e+" has joined!")})),Ee.on("terrain",(function(e,n,t){ln(0,t)})),Ee.on("sendPhys",(function(e,n){yt(e,n)})),Ee.on("physUpdate",(function(e){Ne?(ft(e),console.log("phys synced")):console.log("!!!phys IGNORED")})),Ee.on("physInit",(function(e,n){gt(),e.forEach(((e,n)=>{mt(e[0],e[1],e[2],{x:0,y:0,z:0},{x:0,y:0,z:0,w:0},e[3],e[4])})),ft(n),Ne=!0})),Ee.on("physMake",(function(e,n,t,i,o,a,r){mt(e,n,t,i,o,a,r),console.log("made")})),Ee.on("physDel",(function(e){o.physDel(e),console.log("deleted")})),fetch("/lastChats",{method:"post",headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():void 0})).then((function(e){e&&(e.array.forEach((e=>{Ce(e[0],e[1])})),Te("Last 10 messages"))})).catch((e=>{M(e,"error"),console.error("ERROR ",e)})),fetch("/grid",{method:"post",headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():void 0})).then((function(e){e&&e.grid.length>0&&ln(0,e.grid)})).catch((e=>{M(e,"error"),console.error("ERROR ",e)})),Hn())})).catch((e=>{M(e,"error"),console.error("ERROR ",e)})))})),n.appendChild(i),e.appendChild(n)}(n);let i=document.querySelector("#login-menu");i.appendChild(t),i.appendChild(n),fetch("/getUsers",{method:"post"}).then((function(e){return e.json()})).then((function(e){e&&(function(e){N=[],e.forEach((e=>{N[e.id]=e}))}(e.users),e.users.forEach((e=>{let n=document.createElement("div");n.className="list-item";let i=e.color;n.style.backgroundColor=i;let o=c(l(i));n.style.color=o?"#000000":"#FFFFFF",n.style.textShadow="1px 1px 2px "+(o?"#FFFFFF":"#000000"),n.addEventListener("click",(e=>{let t=document.querySelector("#login-junk");t.style.display="",t.parentElement.classList.remove("bigger-item"),n.appendChild(t),n.classList.add("bigger-item"),e.stopPropagation(),H.focus()}));let a=document.createElement("div");a.className="list-portrait",n.appendChild(a);let r=document.createElement("span");r.innerText=e.username,n.appendChild(r),t.appendChild(n)})))})).catch((e=>{console.error("ERROR"+e)}))}var O,j,W,V=!1,U=1,Y=!1,G=0,J=void 0,X={x:0,y:0};function K(e){let n=I[e];n&&(n.classList.add("cardMax"),n.focused=!0,n.style.zIndex=0,Object.values(n.children).forEach((e=>{"card-notifier"==e.className?e.remove():e.style.display="initial"})),"landscapeCard"==n.id?Bn(!0):Bn(!1),"chatCard"==n.id&&(tt(),ce.focus()),"npcCard"==n.id?Dn(!0):Dn(!1),-1==n.spot?(W.style.top="32px",W.style.left="32px"):(W.style.top=n.style.top,W.style.left=n.style.left),setTimeout((()=>{W.style.opacity="1",W.style.pointerEvents="auto"}),100),F=n)}function Z(){console.log("close called"),F&&(console.log("focused close called"),F.classList.remove("cardMax"),F.style.zIndex=2,F.focused=void 0,Fn(),Bn(!1),Dn(!1),Object.values(F.children).forEach((e=>{"card-notifier"==e.className?e.style.display="initial":e.style.display="none"})),W.style.opacity="0",W.style.pointerEvents="none"),Y&&(Y=!1,ie())}function Q(){clearTimeout(j),j=setTimeout((function(){ie(),Jt()}),250)}function $(e){let n=0,t=[],i=0==U||2==U;e?(n=I.length,t=I):I.forEach((e=>{-1!=e.spot&&(t.push(e),n++)})),i?(R.style.height=64*(n>0?n:1)+"px",R.style.width="82px"):(R.style.width=64*(n>0?n:1)+"px",R.style.height="82px");let o=R.getBoundingClientRect();q=o;let a,r=o.width,l=o.height;a=i?l/n:r/n,e||(i?t.sort((function(e,n){return parseInt(e.style.top)-parseInt(n.style.top)})):t.sort((function(e,n){return parseInt(e.style.left)-parseInt(n.style.left)})));for(let p=0;p<n;p++)O[p]=i?{x:o.left+r/2,y:32+o.top+p*a}:{x:32+o.left+p*a,y:o.top+l/2},J&&J==t[p]&&(X=O[p]),e&&(I[p].spot=p,O[p].app=t[p]),s=t[p],d=O[p].x,c=O[p].y,void 0||(s.pos={x:d,y:c}),s.style.left=d+"px",s.style.top=c+"px";var s,d,c;let p=barHandle.getBoundingClientRect();if(i){let e=p.left+p.width/2;ne({x:e,y:p.top},{x:e,y:p.bottom})}else{let e=p.top+p.height/2;ne({x:p.left,y:e},{x:p.right,y:e})}}function ee(){requestAnimationFrame(ee)}function ne(e,n){e.x,e.y,n.x,n.y}function te(e){if(function(e){if(V){G++;let n=e.clientX,t=e.clientY,i=window.innerWidth/2,o=window.innerHeight/2,a=n-i,r=t-o,l=i-Math.abs(a)<10,s=o-Math.abs(r)<10,d=Math.atan2(r,a)/Math.PI,c=Math.abs(d);c<.25?(2!=U&&(U=2,ie()),l!=Y&&(Y=l,ie())):c<.75?(d<0?3!=U&&(U=3,ie()):1!=U&&(U=1,ie()),s!=Y&&(Y=s,ie())):(0!=U&&(U=0,ie()),l!=Y&&(Y=l,ie()))}}(e),J){if(G++,J.pos={x:e.clientX+J.offset.x,y:e.clientY+J.offset.y},e.clientY>q.top&&e.clientY<q.bottom&&e.clientX>q.left&&e.clientX<q.right){let e=X,n={x:e.x-J.pos.x,y:e.y-J.pos.y};J.pos={x:e.x-n.x/3,y:e.y-n.y/3},J.moving&&(J.moving=void 0,J.spot=0,$())}else J.moving||(J.moving=!0,J.spot=-1,$());J.style.left=J.pos.x+"px",J.style.top=J.pos.y+"px"}}function ie(){2==U?(R.style.left=window.innerWidth-(Y?-32:48)+"px",R.style.top="50%",$(),barHandle.style.transform="translate(-200%,-50%)",barHandle.style.width="32px",barHandle.style.height="80%",R.style.borderWidth="0px 0px 0px 6px",Ae(!1)):3==U?(barHandle.style.transform="translate(-50%,100%)",R.style.left="50%",R.style.top=(Y?-32:48)+"px",$(),barHandle.style.height="32px",barHandle.style.width="80%",R.style.borderWidth="0px 0px 6px 0px",Ae(!1)):1==U?(barHandle.style.transform="translate(-50%,-200%)",R.style.left="50%",R.style.top=window.innerHeight-(Y?-32:48)+"px",$(),barHandle.style.height="32px",barHandle.style.width="80%",R.style.borderWidth="6px 0px 0px 0px",Ae(!0)):(barHandle.style.transform="translate(100%,-50%)",R.style.left=(Y?-32:48)+"px",R.style.top="50%",$(),barHandle.style.width="32px",barHandle.style.height="80%",R.style.borderWidth="0px 6px 0px 0px",Ae(!1))}function oe(e){V&&(V=!1,console.log(G),G<10&&Z()),J?(J.classList.remove("cardMove"),G<20?(F&&F==J&&(J.classList.remove("cardMax"),J.focused=void 0,F=void 0,J.style.zIndex=2),Z(),K(J.appId)):($(),console.log("fix bar also"))):($(),console.log("fix bar")),J=void 0,G=0}var ae,re,le,se,de,ce,pe,ue=!1,me="black";function he(){ue=!0}function fe(e){if(ue){ae.fillStyle=me;let n=e.target.getBoundingClientRect();ae.fillRect(32*(e.clientX-n.left)/132,32*(e.clientY-n.top)/132,2,2)}}function ge(e){ue=!1}function ve(e){we(e.target),ae.fillStyle="rgba(255, 255, 255, 0)",ae.clearRect(0,0,32,32)}function xe(e){we(e.target),function(e){let n=document.createElement("a");n.href=e,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}(e.target.parentElement.parentElement.querySelector(".drawer").toDataURL("image/png"))}function we(e){e.style.animationName="",e.offsetWidth,e.style.animationName="jello"}function ye(e){we(e.target),me=e.target.style.backgroundColor}function be(e){let n=document.createElement("div");return e&&(n.className=e),n}function _e(){return se}var Ee,ke=-1,Le=null,Se=-1;function Ce(e,n){let t=function(e){return N[e]}(e);t||(t={username:"Unknown",id:-1,color:"black"}),function(e,n,t){let i=document.createElement("p"),o=n.color;i.style.backgroundColor=o;let a=c(l(o));i.style.color=a?"#000000":"#FFFFFF",i.style.textShadow="1px 1px 2px "+(a?"#FFFFFF":"#000000");let r=e.indexOf("data:image");if(r>-1){let n=e.indexOf("#",r);if(n>-1){let t=e.substring(r,n);console.log(t);let o=new Image;o.className="stretch-image",o.src=t,i.appendChild(o),e=e.substring(n+1)}}i.innerHTML+=e;{let e=document.createElement("div");if(e.classList.add("chat-row"),n.id==B().id&&e.classList.add("chat-right"),i.classList.add("chat-bubble"),Se>=0&&Se==n.id)ke==n.id?(Le.classList.remove("chat-bubble-footer"),Le.classList.add("chat-bubble-body")):Le.classList.add("chat-bubble-header"),i.classList.add("chat-bubble-footer");else{let e=document.createElement("p");e.classList.add("chat-nametag"),e.innerHTML=n.username;let t=document.createElement("div");n.id==B().id&&(t.style.textAlign="right"),t.appendChild(e),de.appendChild(t)}ke=Se,Le=i,Se=n.id,e.appendChild(i),de.appendChild(e),de.scrollTop=de.scrollHeight}}(n,t),function(e,n){let t=I[2];if(!t.focused){let e=t.querySelector(".card-notifier");e?e.innerText=parseInt(e.innerText)+1:(e=document.createElement("div"),e.className="card-notifier",t.appendChild(e),e.innerText=1),t.style.animation="",t.offsetWidth,t.style.animation="attention 0.2s"}}()}function ze(){ce.blur(),Z(),it(!1)}function Te(e){let n=document.createElement("div");n.className="chat-divider";let t=document.createElement("p");t.innerText=e,n.appendChild(t),de.appendChild(n)}function Ae(e){e?(de.style.height="calc(100vh - 100px)",pe.style.bottom="100px"):(de.style.height="calc(100vh - 64px)",pe.style.bottom="0px")}var Me,Ne=!1;function Pe(e,n,t,i,o,a){Ee.emit("physMake",e,n,t,i,o,a)}function He(e){e||(e="test"),Ee.emit("message",e)}function Ie(e,n){Ee.emit("sendPhys",{id:e.id,position:e.position,velocity:e.velocity,quaternion:e.quaternion,angularVelocity:e.angularVelocity},n)}var Re=[],qe=[],Fe=[];var Be,De,Oe,je=2;function We(e){e?Zt(Oe):$t(Oe)}function Ve(e,n,t){Fe[e][n]=t,Ue()}function Ue(){on=6,Ge();for(let n=0;n<Fe.length;n++)for(let t=0;t<Fe.length;t++){let i=Fe[n][t],o=Math.floor(an(1,4)),a=Math.floor(an(1,6));if(1!=i){let o,r,l,s,d,c;o=n>0?Fe[n-1][t]:0,r=n<Fe.length-1?Fe[n+1][t]:0,t<Fe.length-1?(l=n>0?Fe[n-1][t+1]:0,s=Fe[n][t+1]):(l=0,s=0),t>0?(d=Fe[n][t-1],c=n<Fe.length-1?Fe[n+1][t-1]:0):(d=0,c=0),o=o==i,r=r==i,s=s==i,c=c==i,d=d==i,l=l==i;let p=-1,u=0,m=[],h=5;[l,s,r,c,d,o].forEach(((e,n)=>{e?(m.push(n),-1==p&&(p=n),u=n):h=n}));let f="N",g="";if(6==m.length)Ye(i,"H"+g,n,t,Math.floor(a));else if(m.length>0){let o=[];var e=m[0];for(let n=1;n<m.length;n++)o.push(m[n]-e-1),e=m[n];let a=-1==p?0:p;switch(m.length){case 1:f="E",a+=0;break;case 2:f="P",0==o[0]?(g="3",a+=0):1==o[0]?(g="2",a+=0):2==o[0]?(g="1",a+=0):3==o[0]?(g="2",a+=4):(g="3",a+=5);break;case 3:f="T",0==o[0]?0==o[1]?(g=1,a+=0):3==o[1]?(g=1,a+=5):1==o[1]?(g=3,a+=3):2==o[1]&&(g=2,a+=4):1==o[0]?0==o[1]?g=2:1==o[1]?g=4:2==o[1]&&(g=3,a+=2):2==o[0]?0==o[1]?(g=3,a+=0):1==o[1]&&(g=2,a+=3):(g=1,a+=4),a%=6;break;case 4:f="Q",0==o[0]?0==o[1]?0==o[2]?(g=1,a+=0):1==o[2]?(g=3,a+=2):2==o[2]&&(g=1,a+=5):1==o[1]?0==o[2]?(g=2,a+=4):1==o[2]&&(g=3,a+=1):(g=1,a+=4):1==o[0]?0==o[1]?0==o[2]?(g=3,a+=4):g=2:g=3:(g=1,a+=3),a%=6;break;case 5:f="F",a=h+1}Ye(i,f+g,n,t,a)}else Ye(i,"N",n,t,0)}else 1==i&&Ye(i,"O"+o,n,t,Math.floor(a))}}function Ye(e,n,t,i,o){let a=8*Math.sqrt(3)/2,r="Grass_";switch(e){case 1:r="Grass_";break;case 0:r="Water_";break;case 3:r="Mount_";break;case 4:r="Tree_";break;case 5:r="House_"}let l=Re[r+n];if(l){let e=l.clone();e.position.set(t*a*2-48+i*a,8*i*1.5,-1.6),o&&(o=6-o,e.rotation.z=o*Math.PI/3),qe.push(e),Zt(e)}else console.log("invalid model "+r+n)}function Ge(){qe.forEach((e=>{$t(e)})),qe=[]}function Je(e,n){let t=8*Math.sqrt(3)/2,i=Math.floor((8+n)/12),o=Math.floor((e+48+8-i*t)/(2*t));return Be.position.set(o*t*2-48+i*t,8*i*1.5,.8),[o,i]}let Xe={x:0,y:0},Ke=0;var Ze,Qe,$e,en,nn,tn,on=6;function an(e,n){return(n=n||0)+(on=(9301*on+49297)%233280)/233280*((e=e||1)-n)}function rn(e){return Re[e].clone()}function ln(e,n){Fe=n,Ue()}var sn=2048;Math.PI;let dn,cn=1,pn=-.001;function un(e){let n;switch(e){case 4:n=600,Qe.shadow.camera.far=1200,Qe.shadow.mapSize.width=sn,Qe.shadow.mapSize.height=sn,dn=100,Qe.position.z=600;break;case 3:n=300,Qe.shadow.camera.far=600,Qe.shadow.mapSize.width=sn,Qe.shadow.mapSize.height=sn,dn=100,Qe.position.z=300;break;case 2:n=120,Qe.shadow.camera.far=240,Qe.shadow.mapSize.width=sn,Qe.shadow.mapSize.height=sn,dn=40,Qe.position.z=120;break;case 1:n=75,Qe.shadow.camera.far=150,Qe.shadow.mapSize.width=sn,Qe.shadow.mapSize.height=sn,dn=25,Qe.position.z=75;break;default:n=30,Qe.shadow.camera.far=60,Qe.shadow.mapSize.width=sn,Qe.shadow.mapSize.height=sn,dn=10,Qe.position.z=30}Qe.shadow.camera.left=-n,Qe.shadow.camera.right=n,Qe.shadow.camera.top=n,Qe.shadow.camera.bottom=-n,Qe.shadow.map&&(Qe.shadow.map.dispose(),Qe.shadow.map=null),Ze&&setTimeout((function(){Ze.update()}),100)}function mn(e){e?Ze?Ze.visible=!0:Zt(Ze=new r.Rki(Qe.shadow.camera)):Ze&&(Ze.visible=!1)}var hn,fn,gn=["man","pot","rock","gran"];function vn(){return fn}var xn,wn=t(335),yn=!1,bn=!1,_n=void 0,En=!1,kn=!1,Ln=0,Sn=0,Cn=0,zn=0,Tn=0,An=!1,Mn=[],Nn=0,Pn=0;function Hn(){let e=document.querySelector(".canvasHolder");e.addEventListener("pointermove",Un),e.addEventListener("mousedown",On),e.addEventListener("mouseup",jn),e.addEventListener("touchstart",Wn),e.addEventListener("touchend",Vn),window.addEventListener("contextmenu",$n),window.addEventListener("keyup",nt)}var In=!1;function Rn(e,n,t,i){!function(e,n){(xn=new wn.z(n,e)).callbackCounts=e=>{1==e?_n=setTimeout((function(){En=!0}),100):_n&&clearTimeout(_n)},xn.mouseButtons={LEFT:void 0,MIDDLE:r.RsA.ROTATE,RIGHT:r.RsA.PAN},xn.maxPolarAngle=1.3,xn.isControl(),Fn(),xn.addEventListener("change",(function(e){var n,t=xn.target.distanceTo(xn.object.position);t<30?(0!=In&&un(0),In=0):t<100?(1!=In&&un(1),In=1):t<180?(2!=In&&un(2),In=2):(3!=In&&un(3),In=3),n=xn.target,nn.set(n.x,n.y,n.z),Qe.position.x=n.x,en.position.x=n.x})),xn.addEventListener("end",(function(e){_n&&clearTimeout(_n),En=!1}))}(n,t)}function qn(){console.log("p2"),xn.touches={ONE:69,TWO:r.QmN.DOLLY_PAN}}function Fn(){console.log("p1"),xn.touches={ONE:r.QmN.PAN,TWO:r.QmN.DOLLY_ROTATE}}function Bn(e){(function(e){Be.visible=e})(yn=e),e&&qn()}function Dn(e){bn=e,e&&qn()}function On(e){return 1===e.which&&(kn=!0,!0)}function jn(e){if(2===e.which)return!1;kn=!1,Yn()}function Wn(e){return kn=!0,Ln=e.touches[0].clientX,Sn=e.touches[0].clientY,!0}function Vn(e){kn&&xn.isControl(),kn=!1,Yn()}function Un(e){Ln=e.clientX,Sn=e.clientY}function Yn(){yn&&(Ke=0,Xe.x=0,Xe.y=0)}function Gn(){return Ln}function Jn(){return Sn}function Xn(){return{x:Cn,y:zn,z:Tn}}function Kn(e){let n={x:e.x-Cn,y:e.y-zn,z:e.z-Tn};if(Mn.push(n),Mn.length>6&&Mn.shift(),Cn=e.x,zn=e.y,Tn=e.z,yn)kn||Je(Cn,zn),(En||kn)&&function(e,n){let[t,i]=Je(e,n),o=Fe.length;(t!=Xe.x||i!=Xe.y)&&t>-1&&i>-1&&t<o&&i<o&&(0==Ke&&Fe[t][i]==je?Ve(t,i,1):Ve(t,i,je),Ke++,Xe.x=t,Xe.y=i,De&&(clearTimeout(De),De=null),De=setTimeout((function(){var e;e=Fe,Ee.emit("terrain",B().id,0,e)}),2e3))}(Cn,zn);else if(bn){if(En||kn){let e=vn();if(e){En=!1,kn=!1,Qn();let n=e.charAt(0).toUpperCase()+e.slice(1);Pe({x:1.5,y:1.5,z:3},2,{x:Cn,y:zn,z:Tn+.1},_t(Pn),1,{name:n,color:B().color,model:e})}}}else En||kn?(Qn(),1==(Nn=wt(e,Pn))&&(xn.reset(),qn())):Nn>-1&&(bt(e,Zn()),ot())}function Zn(){let e={x:0,y:0,z:0};return Mn.forEach((n=>{e.x+=n.x,e.y+=n.y,e.z+=n.z})),e}function Qn(){let e=Zn();Math.sqrt(e.x*e.x+e.y*e.y)>.2&&(Pn=Math.PI/2+Math.atan2(e.y,e.x))}function $n(e){return e.preventDefault(),!1}function et(){return xn.object.rotation.z}function nt(e){if(tt())return!1;switch(console.log(e.which),e.which){case 13:K(2);break;case 27:Z();break;case 49:un(0);break;case 50:un(1);break;case 51:un(2);break;case 52:un(3);break;case 53:un(4);break;case 84:case 89:break;case 192:window.pickTarget=a.pick(),window.pickTarget&&console.log("picked a "+window.pickTarget.type)}}function tt(){return An}function it(e){An=e;let n=document.querySelectorAll(".menuHidable");n.length&&n.forEach((n=>{n.style.visibility=e?"hidden":"visible"}))}function ot(){Nn=-1,kn=!1,En=!1,Fn()}var at,rt,lt=t(279),st=0;function dt(){(at=new lt.World).quatNormalizeSkip=0,at.quatNormalizeFast=!1,at.allowSleep=!0,at.gravity.set(0,0,-10),at.broadphase=new lt.NaiveBroadphase;let e=new lt.Box(new lt.Vec3(1,1,2));for(let n=0;n<1;n++){let n=new lt.Body({mass:4});n.addShape(e),n.position.set(0,0,60),at.addBody(n),rt=n,window.playerBody=rt}new lt.Material({name:"gooProperty",friction:10,restitution:-1}).name="gooProperty",new lt.Material({name:"wallProperty",friction:.1,restitution:1}).name="wallProperty",function(){let e=new lt.Plane,n=new lt.Body({mass:0});n.addShape(e),at.addBody(n)}()}function ct(){at.step(.03333333333333333);let e=Object.values(pt);for(var n=0;n!==e.length;n++)if(null!=e[n].id){let t=ut[e[n].id];t.position.copy(e[n].position),t.quaternion.copy(e[n].quaternion)}let t=et(),i=rt.velocity.length();mi.left?(i<2&&(rt.velocity.x-=2*Math.cos(t),rt.velocity.y-=2*Math.sin(t)),st=t+Math.PI/2,rt.quaternion.setFromAxisAngle(new lt.Vec3(0,0,1),st)):mi.right?(i<2&&(rt.velocity.x+=2*Math.cos(t),rt.velocity.y+=2*Math.sin(t)),st=t-Math.PI/2,rt.quaternion.setFromAxisAngle(new lt.Vec3(0,0,1),st)):mi.up?(i<2&&(rt.velocity.x-=2*Math.sin(t),rt.velocity.y+=2*Math.cos(t)),st=t,rt.quaternion.setFromAxisAngle(new lt.Vec3(0,0,1),st)):mi.down&&(i<2&&(rt.velocity.x+=2*Math.sin(t),rt.velocity.y-=2*Math.cos(t)),st=t+Math.PI,rt.quaternion.setFromAxisAngle(new lt.Vec3(0,0,1),st)),Rt.position.copy(rt.position),Rt.quaternion.copy(rt.quaternion)}var pt=[],ut=[];function mt(e,n,t,i,o,a,r){let l,s,d=new lt.Body({mass:t});if(l=a?new lt.Cylinder(n.x,n.y,n.z,6):new lt.Box(new lt.Vec3(n.x,n.y,n.z)),d.addShape(l),d.position.set(i.x,i.y,i.z),o&&d.quaternion.copy(o),d.id=e,d.meta=r,pt[e]=d,at.addBody(d),r&&r.model){let e=E(r.model,r.color);s=ai(),e.position.z=-n.z/2,e.rotation.x=Math.PI/2,s.add(e)}else s=a?ti(n.x,n.y,n.z,i.x,i.y,i.z,r.color):ni(2*n.x,2*n.y,2*n.z,i.x,i.y,i.z,r.color);Zt(s),ut[e]=s,s.physId=e}function ht(e){$t(ut[e]),delete ut[e],at.remove(pt[e]),delete pt[e]}function ft(e){e.forEach((e=>{let n=pt[e[0]];n&&(n.position.copy(e[1]),n.quaternion.copy(e[2]),n.velocity.copy(e[3]),n.angularVelocity.copy(e[4]),n.sleepState!=e[5]&&(2==e[5]?n.sleep():2==n.sleepState&&n.wakeUp()))}))}function gt(){ut.forEach((e=>{$t(e)})),ut=[],Object.values(pt).forEach((e=>{at.remove(e)})),pt=[]}var vt,xt=0;function wt(e,n){if(null==vt){let n,t=6;if(ut.forEach((i=>{if(null!=i.physId){let o=i.position.distanceTo(e);o<t&&(n=i.physId,t=o)}})),null!=n)return vt=pt[n],1;vt=-1}else if(-1!=vt){let t=vt;return t.quaternion.setFromAxisAngle(new lt.Vec3(0,0,1),n),t.position.copy(e),t.position.z+=6,t.sleep(),++xt>10&&(xt=0,Ie(t,!0),console.log("send phys ",t.id,JSON.stringify(t.meta))),1}return 0}function yt(e,n){let t=pt[e.id];t&&(t.position.copy(e.position),t.quaternion.copy(e.quaternion),n?t.sleep():(t.velocity.copy(e.velocity),t.angularVelocity.copy(e.angularVelocity),t.wakeUp()))}function bt(e,n){if(vt&&-1!=vt){let t=vt;t&&(t.wakeUp(),t.position.copy(e),t.velocity.copy(n),t.position.z+=6,xt=0,Ie(t,!1),console.log("send phys NOW"))}vt=void 0}function _t(e){let n=new lt.Quaternion(0,0,0,0);return n.setFromAxisAngle(new lt.Vec3(0,0,1),e),n}function Et(){if(-1!=vt)return vt}var kt,Lt,St,Ct,zt,Tt,At,Mt,Nt,Pt,Ht,It,Rt,qt,Ft,Bt,Dt,Ot=t(145),jt=t(38),Wt=(t(857),t(596)),Vt=t(26);function Ut(){var e;(kt=new r.cPb(45,window.innerWidth/window.innerHeight,1,5e3)).position.z=200,kt.position.y=-200,kt.up=new r.Pa4(0,0,1),kt.lookAt(new r.Pa4(0,0,0)),St=new r.xsS,ii=St,Pt=document.querySelector(".canvasHolder"),(Lt=new r.CP7({antialias:!0,alpha:!0})).shadowMap.enabled=!0,Lt.shadowMap.type=r.ntZ,Lt.toneMapping=r.LY2,Lt.outputEncoding=r.knz,Lt.setClearColor(16744242,1),Pt.appendChild(Lt.domElement),Mt=new Ot.E,e=r.rDY.merge([r.Vj0.standard.uniforms]),new r.jyz({uniforms:e,derivatives:!1,lights:!0,vertexColors:!0,vertexShader:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nuniform vec3 shirt;\nuniform vec3 wind;\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #ifdef USE_COLOR\n        if(color==vec3(0,0,1))\n            vColor.xyz = shirt;\n        else\n            vColor.xyz = color.xyz;\n        \n    #endif\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n    #ifdef USE_TANGENT\n        vTangent = normalize( transformedTangent );\n        vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n    #endif\n#endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    \n        if(color==vec3(1,0,0)){\n            float val=max(0.0, 1.0976 - transformed.z);\n            transformed.xyz+=val*wind;\n            transformed.y*=1.0+sin((wind.z+transformed.z)*4.0)/2.0;\n\n        }\n    \n\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n}",fragmentShader:"\n    #define STANDARD\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n    #define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n    uniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n    #ifdef TRANSPARENCY\n        diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n    #endif\n    gl_FragColor = vec4( outgoingLight,1.-(((0.2125 * outgoingLight.r) + (0.7154 * outgoingLight.g) + (0.0721 * outgoingLight.b)) ) );\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}",roughness:0,metalness:1}),ii=St,zt=kt,Jt(),Ht=new jt.x(Lt);let n=new Wt.G(St,kt,300,200);n.kernelRadius=6,n.minDistance=15e-5,n.maxDistance=.001,Ht.addPass(n),window.ssao=n,new r.vBJ({color:7722446}),new r.Wid({color:2156703,metalness:0,roughness:1}),new r.Wid({color:2156703,metalness:0,roughness:1}),new r.Wid({color:5534117,metalness:0,roughness:1});let t=new r.Wid({color:15398690,metalness:0,roughness:1});It=new r.Wid({color:13576926,metalness:0,roughness:1}),new r.Wid({color:11930379,metalness:0,roughness:1}),new r.Wid({color:15398690,metalness:0,roughness:1}),Ct=new r.ZAu,Rt=new r.ZAu;let i=new r.vBJ({color:16777215,side:r.Wl3}),o=new r.vBJ({color:3282968,side:r.Wl3}),a=ei(1,1,2,0,0,0,t),l=ei(1,.2,1,0,.5,.5,i),s=ei(.3,.2,.3,0,.6,.5,o);Rt.add(a),Rt.add(l),Rt.add(s),Ct.add(Rt);let d=ei(.5,.5,1.5,.75,0,20,new r.vBJ({color:14035807}));Ct.add(d),St.add(Ct),function(){let e=new r.zf8(3,8);Ft=new r.vBJ({color:4907322}),new r.vBJ({color:15461888}),(qt=new r.Kj0(e,Ft)).position.z=.05,St.add(qt)}(),new r.Pa4(1,0,0),nn=new r.Pa4(0,0,0),Qt(tn=new r.Mig(9408399)),(Qe=new r.Ox3(14702423,.5)).position.set(0,250,0),Qe.castShadow=!0,Qt(Qe),(en=new r.Tme).position.set(20,0,20),Qt(en),Qe.target=en,Qe.shadow.mapSize.width=sn,Qe.shadow.mapSize.height=sn,Qe.shadow.camera.near=1,un(0),Qe.shadow.radius=2.2,Qe.shadow.bias=-5e-4,($e=Qe.clone()).shadow.mapSize.width=256,$e.shadow.mapSize.height=256,$e.shadow.radius=0,$e.visible=!1,Qt($e),window.sunLight=Qe,mn(!0),Rn(0,Pt,kt);let c=new r.vBJ({color:16711680}),p=new r.vBJ({color:16746496}),u=new r.vBJ({color:16776960}),m=new r.vBJ({color:65280}),h=new r.vBJ({color:255}),f=new r.vBJ({color:8913151}),g=new r.nvb(1,1,1);return Dt=new r.Kj0(g,[c,p,u,m,h,f]),setTimeout((function(){Xt()}),1),Pt}function Yt(e){e&&!Bt&&(Bt=new Vt.O(St,at))}function Gt(e,n,t,i){Mt.load("./"+e,(e=>{let o;if(e.scene.rotation.x=Math.PI/2,e.scene.traverse((function(e){e instanceof r.Kj0&&(o=e,t||(e.material=i?new r.Wid({color:i,metalness:0,roughness:1}):new r.Wid({vertexColors:r.jSK,metalness:0,roughness:1}),e.material.needsUpdate=!0))})),e.scene.children[0],o){var a=e.animations;if(a&&a.length){Nt=new r.Xcj(o);for(var l=0;l<a.length;l++){var s=a[l];let e=Nt.clipAction(s);e.timeScale=.002,e.play()}}}n(e.scene)}),(e=>{console.log(e.loaded/e.total*100+"% loaded")}),(e=>{console.error("An error happened",e)}))}function Jt(){window.screen.width>window.innerWidth?(Tt=window.innerWidth,At=window.innerHeight):(Tt=window.screen.width,At=window.screen.height),kt.aspect=Tt/At,kt.updateProjectionMatrix(),Lt.setPixelRatio(.5),Lt.setSize(Tt,At)}function Xt(e){ct(),Ct.rotation.z>Math.PI/16||(Ct.rotation.z,Math.PI),function(){var e=new r.Pa4;e.set(Gn()/window.innerWidth*2-1,-Jn()/window.innerHeight*2+1,.5),e.unproject(kt);var n=e.sub(kt.position).normalize(),t=-kt.position.z/n.z,i=kt.position.clone().add(n.multiplyScalar(t));qt.position.x=i.x,qt.position.y=i.y,qt.position.z=2,Kn(qt.position)}(),function(){cn+=pn,cn<0?(cn=0,pn=-pn):cn>1&&(cn=1,pn=-pn),cn&&(Qe.color.setHex(16777215),tn.color.setHex(6316128),oi(11594237,1));let e=dn*cn;en.position.y=nn.y-e,Qe.position.y=nn.y+e}(),Bt&&Bt.update(),Lt.render(ii,zt),requestAnimationFrame(Xt)}function Kt(e,n){Lt.setSize(128,128),Lt.setClearColor(16777215,0),e&&n?Lt.render(e,n):Lt.render(getScene(),kt);let t=Lt.domElement.toDataURL();return Lt.setSize(Tt,At),t}function Zt(e){Ct.add(e)}function Qt(e){St.add(e)}function $t(e){Ct.remove(e)}function ei(e,n,t,i,o,a,l){let s=new r.nvb(e,n,t);l||(l=It);let d=new r.Kj0(s,l);return d.castShadow=!0,d.position.x=i||0,d.position.y=o||0,d.position.z=a||0,d}function ni(e,n,t,i,o,a,l){return ei(e,n,t,i,o,a,l=l?new r.vBJ({color:l}):It)}function ti(e,n,t,i,o,a,l){let s=new r.fHI(e,n,t,6);l=l?new r.vBJ({color:l}):It,s.rotateX(Math.PI/2),s.rotateZ(Math.PI/2);let d=new r.Kj0(s,l);return d.castShadow=!0,d.position.x=i||0,d.position.y=o||0,d.position.z=a||0,d}var ii=0;function oi(e,n){Lt.setClearColor(e,n)}function ai(){return new r.ZAu}let ri;function li(e,n,t,i){let o,a=document.createElement("div"),r=document.createElement("div");if(r.classList.add("switch"),t&&(o=settingsObject[t]),i){o!=i[0]&&(o!=i[i.length-1]?r.classList.add("switchHalf"):r.classList.add("switchOn")),r.setAttribute("value",o);let e=0;for(let n=0;n<i.length;n++)i[n]==o&&(e=n);r.setAttribute("index",e),r.addEventListener("click",(function(e){e.stopPropagation();let t=r.getAttribute("index");t++,t>=i.length&&(t=0),0==t?r.classList.remove("switchOn"):t==i.length-1?(r.classList.remove("switchHalf"),r.classList.add("switchOn")):r.classList.add("switchHalf");let o=i[t];r.setAttribute("value",o),r.setAttribute("index",t),n(o)}))}else o&&r.classList.add("switchOn"),r.addEventListener("click",(function(e){e.stopPropagation(),r.classList.contains("switchOn")?(r.classList.remove("switchOn"),n(!1)):(r.classList.add("switchOn"),n(!0))}));a.appendChild(r);let l=document.createElement("span");l.innerHTML=e,a.appendChild(l),ri.appendChild(a),n(o)}var si,di,ci,pi,ui,mi;function hi(e){di.style.left=e.clientX+"px",di.style.top=e.clientY+"px"}function fi(e,n,t){let i=function(e){let n=document.createElement("div");return n.className=e,n}("equipment-item");e||(e="undefined");let o=document.createElement("h4");o.innerText=e;let a=document.createElement("p");a.innerText=n||"stuff";let r=document.createElement("img");r.className="equipment-icon",t&&(i.setAttribute("data",t),r.setAttribute("src",function(e,n,t){let i=k[e];return i||(i=L(E(e),void 0,void 0),k[e]=i,i)}(t))),i.appendChild(o),i.appendChild(r),i.appendChild(a),i.addEventListener("pointerdown",(e=>{di.children.length&&di.children[0].remove(),(pi=i).classList.add("equipment-item-selected"),di.appendChild(i.cloneNode(!0)),hi(e)})),i.addEventListener("pointerup",(e=>{let n=document.elementFromPoint(e.clientX,e.clientY);(n.classList.contains("equipment-item")||(n=n.parentElement,n.classList.contains("equipment-item")))&&(console.log("up"+n.innerText),pi&&(pi.classList.remove("equipment-item-selected"),ci.insertBefore(pi,n),pi=void 0),di.children.length&&di.children[0].remove())})),ci.appendChild(i)}!function(){ui=document.querySelector("#main"),mi={},function(e){var n;(n=document.createElement("style")).innerHTML='\n\t\t.uiSysTop{\n\t\tdisplay: flex;\n\t\talign-items: flex-start;\n\t\tposition: relative;\n\t\tmax-width: 600px;\n\t\theight: 64px;\n\t\tborder-radius: 32px;\n\t\ttransform: translate(-50%);\n\t\tbox-shadow: 3px 3px 3px #0005;\n\t\tleft: 50%;\n\t\tbackground: #E0F9D5;\n\t\tmargin: 12px;\n\t\tanimation: uiSysUnfold 1s;\n\t\toverflow: hidden;\n\t\tline-height: 16px;\n\t}\n\t.uiSysTop div{\n\n\t\tmargin: 16px;\n\t\tmargin-left: 0px;\n\t\tflex: 0 0 64px;\n\t}\n\t.uiSysTop span{\n\t\tmargin-right: 48px;\n\t\tmargin-top: 8px;\n\t\tline-height: normal;\n\t\tvertical-align: middle;\n\t\tflex: 1;\n\n\t}\n\t@keyframes uiSysUnfold{\n\t\t0%{\n\t\t\tmax-width: 64px;\n\t\t\ttop: -64px;\n\t\t\topacity: 0.2;\n\t\t}\n\t\t50%{\n\t\t\tmax-width: 64px;\n\t\t\ttop:0px;\n\t\t\topacity: 1;\n\t\t}\n\t\t100%{\n\t\t\ttop: 0px;\n\t\t}\n\t}\n\t@keyframes uiSysFold{\n\t\t100%{\n\t\t\tmax-width: 64px;\n\t\t\ttop: -64px;\n\t\t\topacity: 0.2;\n\t\t\theight: 0;\n\t\t}\n\t\t50%{\n\t\t\tmax-width: 64px;\n\t\t\ttop:0px;\n\t\t\topacity: 1;\n\t\t}\n\t\t0%{\n\t\t\ttop: 0px;\n\n\t\t}\n\t}\n\t@keyframes uiSysMini{\n\t\t100%{\n\t\t\tmax-width: 64px;\n\t\t}\n\t\t50%{\n\t\t\tmax-width: 64px;\n\n\t\t}\n\t\t0%{\n\t\t\t\n\t\t}\n\t}\n\t@keyframes uiSysMax{\n\t\t0%{\n\t\t\tmax-width: 64px;\n\t\t}\n\t\t50%{\n\t\t\tmax-width: 64px;\n\t\t}\n\t\t100%{\n\t\t\tleft: 50%;\n\t\t}\n\t}\n\n\t.uiHolderSysTop{\n\t\twidth: 600px;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%);\n\t\t/*border: 3px #0999 dotted;*/\n\t\ttransition: height 1s;\n\t}\n\t.uiIcon{\n\t\tfloat: left;\n\t\twidth: 32px;\n\t\theight: 32px;\n\t\tbackground-repeat: no-repeat;\n\t    background-size:32px;\n\t    background-position: center center;\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 9h-2V5h2v6zm0 4h-2v-2h2v2z"/></svg>\');\n\t}\n\t.uiIconWarning{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>\') !important;\n\t}\n\t.uiIconError{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>\') !important;\n\t}\n\t.uiIconNet{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M23.64 7c-.45-.34-4.93-4-11.64-4-1.5 0-2.89.19-4.15.48L18.18 13.8 23.64 7zm-6.6 8.22L3.27 1.44 2 2.72l2.05 2.06C1.91 5.76.59 6.82.36 7l11.63 14.49.01.01.01-.01 3.9-4.86 3.32 3.32 1.27-1.27-3.46-3.46z"/></svg>\') !important;\n\t}\n\t.uiIconPerson{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>\') !important;\n\t\t\n\t}\n\t.uiIconTime{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>\') !important;\n\t}\n\n\t.uiIconSuccess{\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>\') !important;\n\t}\n\t\n\t.uiCloseButton{\n\t\tposition: absolute;\n\t\tright: 0;\n\t\twidth: 24px;\n\t\theight: 24px;\n\t\tbackground-repeat: no-repeat;\n\t    background-size:16px;\n\t    background-position: center center;\n\t\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>\');\n\t\t\n\t}\n\n\t.uiCursorMessage{\n\t\tmin-width: 64px;\n\t\theight: 64px;\n\t\tborder: 5px solid white;\n\t\tbackground-color: #FBAB7E;\n\t\tbackground-image: linear-gradient(270deg, #FBAB7E 0%, #F7CE68 100%);\n\n\t\tcolor: white;\n\t\tfont-size: 24px;\n\t\tfont-weight: bold;\n\t\tfont-stretch: ultra-condensed;\n\t\ttransform: translate(-50%,-50%);\n\t\tanimation: uiWobble 0.3s;\n\t\tborder-radius: 32px;\n\t\tbox-sizing: border-box;\n\t\tposition: absolute;\n\t\tline-height: 48px;\n\t\tpadding: 0 8px 0 8px;\n\t\tfont-family: sans-serif;\n\t}\n\n\t@keyframes uiWobble{\n\t\t0%{\n\t\t\ttransform: translate(-50%,-50%) scale(0.6,0.4);\n\t\t}\n\t\t33%{\n\t\t\ttransform: translate(-50%,-50%) scale(0.9,1.15);\n\t\t}\n\t\t66%{\n\t\t\ttransform: translate(-50%,-50%) scale(0.8,0.9);\n\t\t}\n\t\t100%{\n\n\t\t}\n\t}\n\n\t@keyframes uiFade{\n\t\t0%{\n\t\t\topacity: 1;\n\t\t\ttransform: translate(-50%,-50%);\n\t\t}\n\t\t100%{\n\t\t\topacity: 0;\n\t\t\ttransform: translate(-50%,0%)\n\t\t}\n\t}\n\n\t.confetti{\n\t\tpointer-events: none;\n\t\tleft:200px;\n\t\ttop:200px;\n\t\twidth:50px;\n\t\theight:50px;\n\t\tposition: absolute;\n\t\tstroke-width:40px;\n\t\t/*background-image: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewbox="0 0 100 100" style="fill:none;stroke:lightgray;stroke-linecap:round;"><path d="M45 65L75 75M45 50L75 50M45 35L75 25" /></svg>\');\n\t\tbackground-size: cover;\n\t\tbackground-position: center;\n\t  \tbackground-repeat: no-repeat;*/\n\t}\n\t.confetti svg{\n\t\tposition: relative;\n\t\tanimation: dooter 0.5s forwards;\n\t\ttransform: translate(-50%,-50%);\n\t\twidth: 50px;\n\t\theight: 50px;\n\t}\n\t@keyframes dooter{\n\t\tfrom{\n\t\t\ttransform: translate(0%,0%) scale(0.1,0.1);\n\t\t\tstroke-width:30;\n\t\t}\n\t\tto{\n\t\t\ttransform: translate(100%,0%) scale(3,3);\n\t\t\tstroke-width:0;\n\t\t\tfilter:hue-rotate(270deg);\n\t\t}\n\t}\n\n\t',document.body.appendChild(n),e?z=e:(z=document.querySelector("#main"),z||(z=document.body)),z?(T=document.createElement("div"),T.className="uiHolderSysTop",z.appendChild(T),A=document.createElement("input"),A.type="text",A.style.position="fixed",A.taxindex="-1",A.style.display="none",A.style.pointerEvents="none",z.appendChild(A)):console.error("UI.js:: uh oh! no system dom element found")}(ui),window.onError=function(e,n,t,i,o){M(e,"error")},dt(),Ut(),Gt("./assets/models/Hex.glb",(e=>{console.log("got children "+e.children.length);let n=new r.Wid({vertexColors:r.jSK,metalness:0,roughness:1});for(let t=0;t<e.children.length;t++){let i=e.children[t];i.position.set(0,0,60),i.scale.set(8,8,8),i.material=n,i.receiveShadow=!0,(i.name.startsWith("Mount")||i.name.startsWith("Tree")||i.name.startsWith("House"))&&(i.castShadow=!0),Re[i.name]=i;let o=[];if(i.geometry){let e=i.geometry.attributes.color.array.length/4;for(let n=0;n<e;n++){let e=4*n,t=d(i.geometry.attributes.color.array[0+e],i.geometry.attributes.color.array[1+e],i.geometry.attributes.color.array[2+e]);o[t]=t}}}function t(e,n){e.addEventListener("click",(e=>{console.log("clicking hex");let t=e.target;t.classList.contains("hex")||(t=t.parentElement),t.classList.remove("jelloAnim"),t.offsetWidth,t.classList.add("jelloAnim"),function(e){je=e,console.log("set hex "+je)}(n)}))}let i=document.querySelectorAll(".hex");i[0].appendChild(S(rn("Grass_O1"))),t(i[0],1),i[1].appendChild(S(rn("Tree_N"),75,-75)),t(i[1],4),i[2].appendChild(S(rn("Grass_P1"))),t(i[2],2),i[3].appendChild(S(rn("Mount_N"),90)),t(i[3],3),i[4].appendChild(S(rn("Water_N"))),t(i[4],0),i[5].appendChild(S(rn("House_N"))),t(i[5],5),function(){Ge();for(let e=0;e<32;e++){Fe[e]=[];for(let n=0;n<32;n++)Fe[e][n]=1}}(),Ue()})),function(){let e=new r.vBJ({color:4907322}),n=new r.ZAu,t=new r.BKK(.6,8),i=new r.Kj0(t,e);i.position.set(8,0,0),n.add(i);for(let e=0;e<6;e++){let t=i.clone();t.rotation.z=e*Math.PI/3,t.position.set(8*Math.cos(t.rotation.z),8*Math.sin(t.rotation.z),0),n.add(t)}n.position.z+=6,Zt(n),(Be=n).visible=!1}(),function(){let e=8*Math.sqrt(3)/2;var n=new r.ZXM;for(let t=0;t<32;t++)for(let i=0;i<32;i++)n.vertices.push(new r.Pa4(-48+e+t*e*2+i*e,8*i*1.5-4,.8)),n.vertices.push(new r.Pa4(-48+e+t*e*2+i*e,4+8*i*1.5,.8)),n.vertices.push(new r.Pa4(-48+e+t*e*2+i*e,4+8*i*1.5,.8)),n.vertices.push(new r.Pa4(t*e*2-48+i*e,8+8*i*1.5,.8)),n.vertices.push(new r.Pa4(t*e*2-48+i*e,8+8*i*1.5,.8)),n.vertices.push(new r.Pa4(-48-e+t*e*2+i*e,4+8*i*1.5,.8));var t=new r.nls({color:16777215});Oe=new r.ejS(n,t)}(),function(){m=new r.xsS,(h=new r.cPb(45,1,1,1e3)).position.z=200,h.position.y=-200,h.up=new r.Pa4(0,0,1),h.lookAt(new r.Pa4(0,0,0));var e=new r.Mig(9408399);m.add(e)}(),function(e){(W=document.querySelector("#closeCard")).addEventListener("click",(e=>{Z()}));let n=document.querySelectorAll(".card");I=[],n.forEach((e=>{I.push(e)})),I.forEach(((e,n)=>{e.style.top=Math.random()*window.innerWidth+"px",e.style.left=Math.random()*window.innerHeight+"px",e.offset={x:0,y:0},e.appId=n,e.addEventListener("pointerdown",(n=>{!function(e,n){e.focused||(J=e,e.pos={x:parseInt(e.style.left),y:parseInt(e.style.top)},X={x:e.pos.x,y:e.pos.y},e.offset={x:e.pos.x-n.clientX,y:e.pos.y-n.clientY},e.classList.add("cardMove"),e.moving=void 0)}(e,n)})),e.addEventListener("dragstart",(e=>{e.preventDefault()}))})),window.addEventListener("pointerup",oe),window.addEventListener("resize",Q),window.addEventListener("pointermove",te),function(){R=document.querySelector("#bar");let e=document.querySelector("#barHandle");e.addEventListener("pointerdown",(e=>{V=!0})),e.addEventListener("dragstart",(e=>{e.preventDefault()})),O=[],e.style.transform="translate(-50%,-200%)",R.style.left="50%",R.style.top=window.innerHeight-64+"px",$(!0)}(),Q(),ee()}(),D(),function(){let e=document.querySelector("#chatCard");(de=document.createElement("div")).classList.add("chat-pane"),e.appendChild(de),(pe=document.createElement("div")).classList.add("chat-bottom"),ce=document.createElement("input");let n="0xffff55";n="#"+n.substring(2,n.length),ce.style.border=n+" 6px solid",pe.appendChild(ce),function(e,n){let t=be("drawer-opener");t.setAttribute("status","chat"),t.addEventListener("click",(n=>{let t=e.querySelector(".drawer-group");t&&"initial"==t.style.display?(t.style.display="none",se=void 0):(re.style.display="initial",e.appendChild(re),se=n.target.getAttribute("status"))})),e.appendChild(t)}(pe),e.appendChild(pe),ce.addEventListener("keyup",(function(e){if(13==e.which)if(ce.value.length>0||"chat"==_e()){let e="";"chat"==_e()&&(e+=le.toDataURL("image/png")+"#",re.style.display="none",se=void 0),e+=ce.value,n=e,Ee.emit("message",n),ce.value=""}else setTimeout(ze,20);else 27==e.which&&ze();var n})),document.createElement("div").classList.add("letterPane")}(),ri=document.querySelector(".settingsPane"),li("Toggle Hex Grid Lines",We),li("Toggle Light Helper",mn),li("Toggle Physics Mesh Helper",Yt),hn=document.querySelector("#makerBar"),gn.forEach((e=>{!function(e){let n=function(e){let n=document.createElement("div");return n.className="makerIcon",n}();n.setAttribute("data",e),n.addEventListener("click",(e=>{fn=e.target.getAttribute("data")})),n.innerText=e,hn.appendChild(n)}(e)})),y("pot"),y("rock"),w("assets/models/man.gltf",((e,n)=>{var t;e=e.children[0],(p=e).castShadow=!0,p.receiveShadow=!0,e.scale.set(2,2,2),n&&n.forEach((e=>{e.name&&(v[e.name]=e)})),b(e,[1,.2541521191596985,.022173885256052017],[0,0,1]),new r.Pa4(0,0,1),(t=r.rDY.merge([r.Vj0.phong.uniforms,{shirt:{value:new r.Pa4(0,1,0)},wind:{value:new r.Pa4(0,0,0)}}])).ambientLightColor.value=null,(u=new r.jyz({uniforms:t,derivatives:!1,lights:!0,vertexColors:!0,vertexShader:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nuniform vec3 shirt;\nuniform vec3 wind;\n\nvoid main() {\n    #include <uv_vertex>\n    #include <uv2_vertex>\n    #ifdef USE_COLOR\n        if(color==vec3(0,0,1))\n            vColor.xyz = shirt;\n        else\n            vColor.xyz = color.xyz;\n        \n    #endif\n    #include <beginnormal_vertex>\n    #include <morphnormal_vertex>\n    #include <skinbase_vertex>\n    #include <skinnormal_vertex>\n    #include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n    #ifdef USE_TANGENT\n        vTangent = normalize( transformedTangent );\n        vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n    #endif\n#endif\n    #include <begin_vertex>\n    #include <morphtarget_vertex>\n    #include <skinning_vertex>\n    #include <displacementmap_vertex>\n\n    \n        if(color==vec3(1,0,0)){\n            float val=max(0.0, 1.0976 - transformed.z);\n            transformed.xyz+=val*wind;\n            transformed.y*=1.0+sin((wind.z+transformed.z)*4.0)/2.0;\n\n        }\n    \n\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <clipping_planes_vertex>\n    vViewPosition = - mvPosition.xyz;\n    #include <worldpos_vertex>\n    #include <shadowmap_vertex>\n    #include <fog_vertex>\n}",fragmentShader:"\n    #define STANDARD\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n    #define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n    uniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n    varying vec3 vNormal;\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n    #include <clipping_planes_fragment>\n    vec4 diffuseColor = vec4( diffuse, opacity );\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n    vec3 totalEmissiveRadiance = emissive;\n    #include <logdepthbuf_fragment>\n    #include <map_fragment>\n    #include <color_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    #include <roughnessmap_fragment>\n    #include <metalnessmap_fragment>\n    #include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n    #include <lights_physical_fragment>\n    #include <lights_fragment_begin>\n    #include <lights_fragment_maps>\n    #include <lights_fragment_end>\n    #include <aomap_fragment>\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n    #ifdef TRANSPARENCY\n        diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n    #endif\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n    #include <fog_fragment>\n    #include <premultiplied_alpha_fragment>\n    #include <dithering_fragment>\n}"})).needsUpdate=!0,u.skinning=!0,x.man=p,u.onBeforeCompile=e=>{e.uniforms.shirt=man.children[1].material.uniforms.shirt,e.vertexShader="uniform vec3 shirt;\n"+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <color_vertex>","\n                #ifdef USE_COLOR\n                    if(color.xyz == vec3(0,0,1)){\n                        vColor.xyz = vec3(1,1,0);\n                    }else{\n                        vColor.xyz = color.xyz;\n                    }\n                #endif")}})),w("assets/models/gran.gltf",((e,n)=>{(e=e.children[0]).castShadow=!0,e.receiveShadow=!0,e.scale.set(2,2,2),b(e,[.42869052290916443,.262250691652298,.4677838087081909],[0,0,1]),new r.Pa4(0,0,1),x.gran=e})),function(){var e;(e=document.createElement("style")).innerHTML='\n.drawer-group{\n    position: absolute;\n    top: -204px;\n    width: 128px;\n    left: 50%;\n    transform: translate(-50%,0);\n}\n.drawer {\n    display:block;\n    width: 128px;\n    height: 128px;\n    position: relative;\n    border-radius: 8px;\n    border: gray solid 1px;\n    image-rendering: pixelated;\n    touch-action: none;\n}\n\n.drawer-top{\nposition: relative;\npointer-events: none;\n}\n.drawer-top *{\n    pointer-events: initial;\n}\n\n.drawer-paint,\n.drawer-trash,\n.drawer-download {\n    width: 24px;\n    height: 24px;\n    border-radius: 12px;\n    display: inline-block;\n    border: gray solid 1px;\n    box-sizing: border-box;\n    animation: 0.2s;\n}\n\n\n.drawer-trash {\n    border: none;\n    background-position: center center;\n    background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>\');\n}\n\n.drawer-download {\n    border: none;\n    background-size: cover;\n    background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 5v11.17l-4.88-4.88c-.39-.39-1.03-.39-1.42 0-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0l6.59-6.59c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0L13 16.17V5c0-.55-.45-1-1-1s-1 .45-1 1z"/></svg>\');\n}\n.drawer-opener{\n    width:48px;\n    height: 48px;\n    border-radius:24px;\n    background-color: white;\n    position: relative;\n    display: inline-block;\n    background-size: 32px;\n    background-position: center center;\n    background-repeat: no-repeat;\n\n    background-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.9 13.98l2.1 2.53 3.1-3.99c.2-.26.6-.26.8.01l3.51 4.68c.25.33.01.8-.4.8H6.02c-.42 0-.65-.48-.39-.81L8.12 14c.19-.26.57-.27.78-.02z"/></svg>\');\n}\n.stretch-image{\n    width: 64px;\n    height 64px;\n}\n',document.body.appendChild(e),re=document.querySelector(".drawer-group"),(le=re.querySelector(".drawer")).setAttribute("width","32px"),le.setAttribute("height","32px"),le.addEventListener("pointerdown",he),le.addEventListener("pointermove",fe),window.addEventListener("pointerup",ge),(ae=le.getContext("2d")).imageSmoothingEnabled=!1;let n=re.querySelector(".drawer-top"),t=be("drawer-paint");t.style.backgroundColor="black",t.addEventListener("pointerup",ye);let i=be("drawer-paint");i.style.backgroundColor="red",i.addEventListener("pointerup",ye);let o=be("drawer-paint");o.style.backgroundColor="#65BB00",o.addEventListener("pointerup",ye);let a=be("drawer-paint");a.style.backgroundColor="white",a.addEventListener("pointerup",ye);let r=be("drawer-download");r.addEventListener("pointerup",xe);let l=be("drawer-trash");l.addEventListener("pointerup",ve),n.appendChild(t),n.appendChild(i),n.appendChild(o),n.appendChild(a),n.appendChild(r),n.appendChild(l),document.onpaste=function(e){var n=(e.clipboardData||e.originalEvent.clipboardData).items;let t;for(t in console.log(JSON.stringify(n)),n){var i=n[t];if("file"===i.kind){var o=i.getAsFile(),a=new FileReader;a.onload=function(e){var n=new Image;n.onload=function(){ae.fillStyle="rgba(255, 255, 255, 0)",ae.drawImage(n,0,0,32,32)},n.src=e.target.result},a.readAsDataURL(o)}}}}();let e=setInterval((function(){var n;g<=0&&((n=document.createElement("style")).innerHTML="\n\t#equipment-bar{\n\t\tposition: absolute;\n\t\tborder-radius: 16px;\n\t\tbackground-color: #fff5;\n\t\tborder-radius: 16px;\n\t\tmin-height: 128px;\n        max-height: 60%;\n\t\twidth: 512px;\n\t\tbottom: 96px;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%);\n\t\toverflow-x: hidden;\n\t\toverflow-y: auto;\n\t\ttouch-action: none;\n        pointer-events:auto;\n\t}\n\t.equipment-item{\n\t\tuser-select: none;\n\t\tborder-radius: 8px;\n\t\tbackground-color: white;\n\t\tdisplay: inline-block;\n\t\tmin-height: 16px;\n\t\tmin-width: 16px;\n        max-width: 200px;\n\t\tmargin: 8px;\n\t\tbox-sizing: border-box;\n\t}\n\t.equipment-item-selected{\n\t\tborder: dashed white 3px;\n\t\topacity: 0.5;\n\t}\n\t.equipment-item h4{\n        display:block;\n        margin:6px;\n\t}\n\t.equipment-item p{\n\t\tdisplay: inline-block;\n\t\tmargin: 16px;\n\t}\n\t.equipment-icon{\n\t\tmin-width: 48px;\n\t\tmin-height: 48px;\n\t\tborder-radius: 8px;\n\t\tbackground-color: gray;\n\t\tdisplay: inline-block;\n\t}\n\t#pseduo-dragger{\n\t\tposition: absolute;\n\t\tpointer-events: none;\n\t}",document.body.appendChild(n),si=document.querySelector("#inventoryCard"),ci=si.querySelector("#equipment-bar"),di=si.querySelector("#pseduo-dragger"),window.addEventListener("pointermove",(e=>{pi&&hi(e)})),ci.addEventListener("pointerup",(e=>{if(!pi){let e=Et();e&&(fi(e.meta.name,e.meta.description,e.meta.model),ht(e.id),ot())}})),window.addEventListener("pointerup",(e=>{if(pi){pi.classList.remove("equipment-item-selected"),di.children.length&&di.children[0].remove(),pi.style.display="none";let e=function(e){let n={},t=e.querySelector("h4"),i=e.querySelector("p"),o=e.getAttribute("data");return t&&(n.name=t.innerText),i&&(n.description=i.innerText),o&&(n.model=o),n}(pi);if(e){let n=Xn();e.color=B().color,Pe({x:1.5,y:1.5,z:3},2,{x:n.x,y:n.y,z:30},_t(Math.PI/2),1,e)}pi=void 0}})),fi("A Man","Good boi","man"),fi("Cool Rock","It's a cool rock","rock"),fi("Pot","420","pot"),clearInterval(e))}),1e3)}()}},0,[[224,666,977]]]);